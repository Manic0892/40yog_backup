!function(t){"use strict";if(Number.prototype.map=function(t,e,i,n){return i+(n-i)*((this-t)/(e-t))},Number.prototype.limit=function(t,e){return Math.min(e,Math.max(t,this))},Number.prototype.round=function(t){return t=Math.pow(10,t||0),Math.round(this*t)/t},Number.prototype.floor=function(){return Math.floor(this)},Number.prototype.ceil=function(){return Math.ceil(this)},Number.prototype.toInt=function(){return 0|this},Number.prototype.toRad=function(){return this/180*Math.PI},Number.prototype.toDeg=function(){return 180*this/Math.PI},Array.prototype.erase=function(t){for(var e=this.length;e--;)this[e]===t&&this.splice(e,1);return this},Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]},Function.prototype.bind=Function.prototype.bind||function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},s=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,s.prototype=new n,s},t.ig={game:null,debug:null,version:"1.22",global:t,modules:{},resources:[],ready:!1,baked:!1,nocache:"",ua:{},prefix:t.ImpactPrefix||"",lib:"lib/",_current:null,_loadQueue:[],_waitForOnload:0,$:function(t){return"#"==t.charAt(0)?document.getElementById(t.substr(1)):document.getElementsByTagName(t)},$new:function(t){return document.createElement(t)},copy:function(t){if(!t||"object"!=typeof t||t instanceof HTMLElement||t instanceof ig.Class)return t;if(t instanceof Array){for(var e=[],i=0,n=t.length;n>i;i++)e[i]=ig.copy(t[i]);return e}var e={};for(var i in t)e[i]=ig.copy(t[i]);return e},merge:function(t,e){for(var i in e){var n=e[i];"object"!=typeof n||n instanceof HTMLElement||n instanceof ig.Class?t[i]=n:(t[i]&&"object"==typeof t[i]||(t[i]=n instanceof Array?[]:{}),ig.merge(t[i],n))}return t},ksort:function(t){if(!t||"object"!=typeof t)return[];var e=[],i=[];for(var n in t)e.push(n);e.sort();for(var n=0;n<e.length;n++)i.push(t[e[n]]);return i},setVendorAttribute:function(t,e,i){var n=e.charAt(0).toUpperCase()+e.substr(1);t[e]=t["ms"+n]=t["moz"+n]=t["webkit"+n]=t["o"+n]=i},getVendorAttribute:function(t,e){var i=e.charAt(0).toUpperCase()+e.substr(1);return t[e]||t["ms"+i]||t["moz"+i]||t["webkit"+i]||t["o"+i]},normalizeVendorAttribute:function(t,e){var i=ig.getVendorAttribute(t,e);!t[e]&&i&&(t[e]=i)},getImagePixels:function(t,e,i,n,s){var a=ig.$new("canvas");a.width=t.width,a.height=t.height;var o=a.getContext("2d");ig.System.SCALE.CRISP(a,o);var r=ig.getVendorAttribute(o,"backingStorePixelRatio")||1;ig.normalizeVendorAttribute(o,"getImageDataHD");var l=t.width/r,h=t.height/r;return a.width=Math.ceil(l),a.height=Math.ceil(h),o.drawImage(t,0,0,l,h),1===r?o.getImageData(e,i,n,s):o.getImageDataHD(e,i,n,s)},module:function(t){if(ig._current)throw"Module '"+ig._current.name+"' defines nothing";if(ig.modules[t]&&ig.modules[t].body)throw"Module '"+t+"' is already defined";return ig._current={name:t,requires:[],loaded:!1,body:null},ig.modules[t]=ig._current,ig._loadQueue.push(ig._current),ig},requires:function(){return ig._current.requires=Array.prototype.slice.call(arguments),ig},defines:function(t){ig._current.body=t,ig._current=null,ig._initDOMReady()},addResource:function(t){ig.resources.push(t)},setNocache:function(t){ig.nocache=t?"?"+Date.now():""},log:function(){},assert:function(){},show:function(){},mark:function(){},_loadScript:function(t,e){ig.modules[t]={name:t,requires:[],loaded:!1,body:null},ig._waitForOnload++;var i=ig.prefix+ig.lib+t.replace(/\./g,"/")+".js"+ig.nocache,n=ig.$new("script");n.type="text/javascript",n.src=i,n.onload=function(){ig._waitForOnload--,ig._execModules()},n.onerror=function(){throw"Failed to load module "+t+" at "+i+" "+"required from "+e},ig.$("head")[0].appendChild(n)},_execModules:function(){for(var t=!1,e=0;e<ig._loadQueue.length;e++){for(var i=ig._loadQueue[e],n=!0,s=0;s<i.requires.length;s++){var a=i.requires[s];ig.modules[a]?ig.modules[a].loaded||(n=!1):(n=!1,ig._loadScript(a,i.name))}n&&i.body&&(ig._loadQueue.splice(e,1),i.loaded=!0,i.body(),t=!0,e--)}if(t)ig._execModules();else if(!ig.baked&&0==ig._waitForOnload&&0!=ig._loadQueue.length){for(var o=[],e=0;e<ig._loadQueue.length;e++){for(var r=[],l=ig._loadQueue[e].requires,s=0;s<l.length;s++){var i=ig.modules[l[s]];i&&i.loaded||r.push(l[s])}o.push(ig._loadQueue[e].name+" (requires: "+r.join(", ")+")")}throw"Unresolved (circular?) dependencies. Most likely there's a name/path mismatch for one of the listed modules:\n"+o.join("\n")}},_DOMReady:function(){if(!ig.modules["dom.ready"].loaded){if(!document.body)return setTimeout(ig._DOMReady,13);ig.modules["dom.ready"].loaded=!0,ig._waitForOnload--,ig._execModules()}return 0},_boot:function(){document.location.href.match(/\?nocache/)&&ig.setNocache(!0),ig.ua.pixelRatio=t.devicePixelRatio||1,ig.ua.viewport={width:t.innerWidth,height:t.innerHeight},ig.ua.screen={width:t.screen.availWidth*ig.ua.pixelRatio,height:t.screen.availHeight*ig.ua.pixelRatio},ig.ua.iPhone=/iPhone/i.test(navigator.userAgent),ig.ua.iPhone4=ig.ua.iPhone&&2==ig.ua.pixelRatio,ig.ua.iPad=/iPad/i.test(navigator.userAgent),ig.ua.android=/android/i.test(navigator.userAgent),ig.ua.winPhone=/Windows Phone/i.test(navigator.userAgent),ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad,ig.ua.mobile=ig.ua.iOS||ig.ua.android||ig.ua.winPhone,ig.ua.touchDevice="ontouchstart"in t||t.navigator.msMaxTouchPoints},_initDOMReady:function(){return ig.modules["dom.ready"]?(ig._execModules(),void 0):(ig._boot(),ig.modules["dom.ready"]={requires:[],loaded:!1,body:null},ig._waitForOnload++,"complete"===document.readyState?ig._DOMReady():(document.addEventListener("DOMContentLoaded",ig._DOMReady,!1),t.addEventListener("load",ig._DOMReady,!1)),void 0)}},ig.normalizeVendorAttribute(t,"requestAnimationFrame"),t.requestAnimationFrame){var e=1,i={};t.ig.setAnimation=function(n,s){var a=e++;i[a]=!0;var o=function(){i[a]&&(t.requestAnimationFrame(o,s),n())};return t.requestAnimationFrame(o,s),a},t.ig.clearAnimation=function(t){delete i[t]}}else t.ig.setAnimation=function(e){return t.setInterval(e,1e3/60)},t.ig.clearAnimation=function(e){t.clearInterval(e)};var n=!1,s=/xyz/.test(function(){})?/\bparent\b/:/.*/;t.ig.Class=function(){};var a=function(t){var e=this.prototype,i={};for(var n in t)"function"==typeof t[n]&&"function"==typeof e[n]&&s.test(t[n])?(i[n]=e[n],e[n]=function(t,e){return function(){var n=this.parent;this.parent=i[t];var s=e.apply(this,arguments);return this.parent=n,s}}(n,t[n])):e[n]=t[n]};t.ig.Class.extend=function(e){function i(){if(!n){if(this.staticInstantiate){var t=this.staticInstantiate.apply(this,arguments);if(t)return t}for(var e in this)"object"==typeof this[e]&&(this[e]=ig.copy(this[e]));this.init&&this.init.apply(this,arguments)}return this}var o=this.prototype;n=!0;var r=new this;n=!1;for(var l in e)r[l]="function"==typeof e[l]&&"function"==typeof o[l]&&s.test(e[l])?function(t,e){return function(){var i=this.parent;this.parent=o[t];var n=e.apply(this,arguments);return this.parent=i,n}}(l,e[l]):e[l];return i.prototype=r,i.prototype.constructor=i,i.extend=t.ig.Class.extend,i.inject=a,i},t.ImpactMixin&&ig.merge(ig,t.ImpactMixin)}(window),ig.baked=!0,ig.module("impact.image").defines(function(){"use strict";ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:!1,failed:!1,loadCallback:null,path:"",staticInstantiate:function(t){return ig.Image.cache[t]||null},init:function(t){this.path=t,this.load()},load:function(t){return this.loaded?(t&&t(this.path,!0),void 0):(!this.loaded&&ig.ready?(this.loadCallback=t||null,this.data=new Image,this.data.onload=this.onload.bind(this),this.data.onerror=this.onerror.bind(this),this.data.src=ig.prefix+this.path+ig.nocache):ig.addResource(this),ig.Image.cache[this.path]=this,void 0)},reload:function(){this.loaded=!1,this.data=new Image,this.data.onload=this.onload.bind(this),this.data.src=this.path+"?"+Date.now()},onload:function(){this.width=this.data.width,this.height=this.data.height,this.loaded=!0,1!=ig.system.scale&&this.resize(ig.system.scale),this.loadCallback&&this.loadCallback(this.path,!0)},onerror:function(){this.failed=!0,this.loadCallback&&this.loadCallback(this.path,!1)},resize:function(t){var e=ig.getImagePixels(this.data,0,0,this.width,this.height),i=this.width*t,n=this.height*t,s=ig.$new("canvas");s.width=i,s.height=n;for(var a=s.getContext("2d"),o=a.getImageData(0,0,i,n),r=0;n>r;r++)for(var l=0;i>l;l++){var h=4*(Math.floor(r/t)*this.width+Math.floor(l/t)),c=4*(r*i+l);o.data[c]=e.data[h],o.data[c+1]=e.data[h+1],o.data[c+2]=e.data[h+2],o.data[c+3]=e.data[h+3]}a.putImageData(o,0,0),this.data=s},draw:function(t,e,i,n,s,a){if(this.loaded){var o=ig.system.scale;i=i?i*o:0,n=n?n*o:0,s=(s?s:this.width)*o,a=(a?a:this.height)*o,ig.system.context.drawImage(this.data,i,n,s,a,ig.system.getDrawPos(t),ig.system.getDrawPos(e),s,a),ig.Image.drawCount++}},drawTile:function(t,e,i,n,s,a,o){if(s=s?s:n,!(!this.loaded||n>this.width||s>this.height)){var r=ig.system.scale,l=Math.floor(n*r),h=Math.floor(s*r),c=a?-1:1,d=o?-1:1;(a||o)&&(ig.system.context.save(),ig.system.context.scale(c,d)),ig.system.context.drawImage(this.data,Math.floor(i*n)%this.width*r,Math.floor(i*n/this.width)*s*r,l,h,ig.system.getDrawPos(t)*c-(a?l:0),ig.system.getDrawPos(e)*d-(o?h:0),l,h),(a||o)&&ig.system.context.restore(),ig.Image.drawCount++}}}),ig.Image.drawCount=0,ig.Image.cache={},ig.Image.reloadCache=function(){for(var t in ig.Image.cache)ig.Image.cache[t].reload()}}),ig.baked=!0,ig.module("impact.font").requires("impact.image").defines(function(){"use strict";ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(t){this._loadMetrics(this.data),this.parent(t)},widthForString:function(t){if(-1!==t.indexOf("\n")){for(var e=t.split("\n"),i=0,n=0;n<e.length;n++)i=Math.max(i,this._widthForLine(e[n]));return i}return this._widthForLine(t)},_widthForLine:function(t){for(var e=0,i=0;i<t.length;i++)e+=this.widthMap[t.charCodeAt(i)-this.firstChar]+this.letterSpacing;return e},heightForString:function(t){return t.split("\n").length*(this.height+this.lineSpacing)},draw:function(t,e,i,n){if("string"!=typeof t&&(t=t.toString()),-1===t.indexOf("\n")){if(n==ig.Font.ALIGN.RIGHT||n==ig.Font.ALIGN.CENTER){var s=this._widthForLine(t);e-=n==ig.Font.ALIGN.CENTER?s/2:s}1!==this.alpha&&(ig.system.context.globalAlpha=this.alpha);for(var a=0;a<t.length;a++){var o=t.charCodeAt(a);e+=this._drawChar(o-this.firstChar,e,i)}1!==this.alpha&&(ig.system.context.globalAlpha=1),ig.Image.drawCount+=t.length}else for(var r=t.split("\n"),l=this.height+this.lineSpacing,a=0;a<r.length;a++)this.draw(r[a],e,i+a*l,n)},_drawChar:function(t,e,i){if(!this.loaded||0>t||t>=this.indices.length)return 0;var n=ig.system.scale,s=this.indices[t]*n,a=0,o=this.widthMap[t]*n,r=(this.height-2)*n;return ig.system.context.drawImage(this.data,s,a,o,r,ig.system.getDrawPos(e),ig.system.getDrawPos(i),o,r),this.widthMap[t]+this.letterSpacing},_loadMetrics:function(t){this.height=t.height-1,this.widthMap=[],this.indices=[];for(var e=ig.getImagePixels(t,0,t.height-1,t.width,1),i=0,n=0,s=0;s<t.width;s++){var a=4*s+3;e.data[a]>127?n++:e.data[a]<128&&n&&(this.widthMap.push(n),this.indices.push(s-n),i++,n=0)}this.widthMap.push(n),this.indices.push(s-n)}}),ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2}}),ig.baked=!0,ig.module("impact.sound").defines(function(){"use strict";ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){if(!ig.Sound.enabled||!window.Audio)return ig.Sound.enabled=!1,void 0;for(var t=new Audio,e=0;e<ig.Sound.use.length;e++){var i=ig.Sound.use[e];if(t.canPlayType(i.mime)){this.format=i;break}}this.format||(ig.Sound.enabled=!1)},load:function(t,e,i){var n=ig.prefix+t.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[t]){if(e&&this.clips[t].length<ig.Sound.channels)for(var s=this.clips[t].length;s<ig.Sound.channels;s++){var a=new Audio(n);a.load(),this.clips[t].push(a)}return this.clips[t][0]}var o=new Audio(n);if(i&&(o.addEventListener("canplaythrough",function r(e){o.removeEventListener("canplaythrough",r,!1),i(t,!0,e)},!1),o.addEventListener("error",function(e){i(t,!1,e)},!1)),o.preload="auto",o.load(),this.clips[t]=[o],e)for(var s=1;s<ig.Sound.channels;s++){var a=new Audio(n);a.load(),this.clips[t].push(a)}return o},get:function(t){for(var e,i=this.clips[t],n=0;e=i[n++];)if(e.paused||e.ended)return e.ended&&(e.currentTime=0),e;return i[0].pause(),i[0].currentTime=0,i[0]}}),ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:!1,_volume:1,_loop:!1,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this),Object.defineProperty?(Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)}),Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)})):this.__defineGetter__&&(this.__defineGetter__("volume",this.getVolume.bind(this)),this.__defineSetter__("volume",this.setVolume.bind(this)),this.__defineGetter__("loop",this.getLooping.bind(this)),this.__defineSetter__("loop",this.setLooping.bind(this)))},add:function(t,e){if(ig.Sound.enabled){var i=t instanceof ig.Sound?t.path:t,n=ig.soundManager.load(i,!1);n.loop=this._loop,n.volume=this._volume,n.addEventListener("ended",this._endedCallbackBound,!1),this.tracks.push(n),e&&(this.namedTracks[e]=n),this.currentTrack||(this.currentTrack=n)}},next:function(){this.tracks.length&&(this.stop(),this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length,this.currentTrack=this.tracks[this.currentIndex],this.play())},pause:function(){this.currentTrack&&this.currentTrack.pause()},stop:function(){this.currentTrack&&(this.currentTrack.pause(),this.currentTrack.currentTime=0)},play:function(t){if(t&&this.namedTracks[t]){var e=this.namedTracks[t];e!=this.currentTrack&&(this.stop(),this.currentTrack=e)}else if(!this.currentTrack)return;this.currentTrack.play()},getLooping:function(){return this._loop},setLooping:function(t){this._loop=t;for(var e in this.tracks)this.tracks[e].loop=t},getVolume:function(){return this._volume},setVolume:function(t){this._volume=t.limit(0,1);for(var e in this.tracks)this.tracks[e].volume=this._volume},fadeOut:function(t){this.currentTrack&&(clearInterval(this._fadeInterval),this.fadeTimer=new ig.Timer(t),this._fadeInterval=setInterval(this._fadeStep.bind(this),50))},_fadeStep:function(){var t=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;.01>=t?(this.stop(),this.currentTrack.volume=this._volume,clearInterval(this._fadeInterval)):this.currentTrack.volume=t},_endedCallback:function(){this._loop?this.play():this.next()}}),ig.Sound=ig.Class.extend({path:"",volume:1,currentClip:null,multiChannel:!0,init:function(t,e){this.path=t,this.multiChannel=e!==!1,this.load()},load:function(t){return ig.Sound.enabled?(ig.ready?ig.soundManager.load(this.path,this.multiChannel,t):ig.addResource(this),void 0):(t&&t(this.path,!0),void 0)},play:function(){ig.Sound.enabled&&(this.currentClip=ig.soundManager.get(this.path),this.currentClip.volume=ig.soundManager.volume*this.volume,this.currentClip.play())},stop:function(){this.currentClip&&(this.currentClip.pause(),this.currentClip.currentTime=0)}}),ig.Sound.FORMAT={MP3:{ext:"mp3",mime:"audio/mpeg"},M4A:{ext:"m4a",mime:"audio/mp4; codecs=mp4a"},OGG:{ext:"ogg",mime:"audio/ogg; codecs=vorbis"},WEBM:{ext:"webm",mime:"audio/webm; codecs=vorbis"},CAF:{ext:"caf",mime:"audio/x-caf"}},ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3],ig.Sound.channels=4,ig.Sound.enabled=!0}),ig.baked=!0,ig.module("impact.loader").requires("impact.image","impact.font","impact.sound").defines(function(){"use strict";ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:!1,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(t,e){this.gameClass=t,this.resources=e,this._loadCallbackBound=this._loadCallback.bind(this);for(var i=0;i<this.resources.length;i++)this._unloaded.push(this.resources[i].path)},load:function(){if(ig.system.clear("#000"),!this.resources.length)return this.end(),void 0;for(var t=0;t<this.resources.length;t++)this.loadResource(this.resources[t]);this._intervalId=setInterval(this.draw.bind(this),16)},loadResource:function(t){t.load(this._loadCallbackBound)},end:function(){this.done||(this.done=!0,clearInterval(this._intervalId),ig.system.setGame(this.gameClass))},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var t=ig.system.scale,e=.6*ig.system.width,i=.1*ig.system.height,n=.5*ig.system.width-e/2,s=.5*ig.system.height-i/2;ig.system.context.fillStyle="#000",ig.system.context.fillRect(0,0,480,320),ig.system.context.fillStyle="#fff",ig.system.context.fillRect(n*t,s*t,e*t,i*t),ig.system.context.fillStyle="#000",ig.system.context.fillRect(n*t+t,s*t+t,e*t-t-t,i*t-t-t),ig.system.context.fillStyle="#fff",ig.system.context.fillRect(n*t,s*t,e*t*this._drawStatus,i*t)},_loadCallback:function(t,e){if(!e)throw"Failed to load resource: "+t;this._unloaded.erase(t),this.status=1-this._unloaded.length/this.resources.length,0==this._unloaded.length&&setTimeout(this.end.bind(this),250)}})}),ig.baked=!0,ig.module("impact.timer").defines(function(){"use strict";ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(t){this.base=ig.Timer.time,this.last=ig.Timer.time,this.target=t||0},set:function(t){this.target=t||0,this.base=ig.Timer.time,this.pausedAt=0},reset:function(){this.base=ig.Timer.time,this.pausedAt=0},tick:function(){var t=ig.Timer.time-this.last;return this.last=ig.Timer.time,this.pausedAt?0:t},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target},pause:function(){this.pausedAt||(this.pausedAt=ig.Timer.time)},unpause:function(){this.pausedAt&&(this.base+=ig.Timer.time-this.pausedAt,this.pausedAt=0)}}),ig.Timer._last=0,ig.Timer.time=Number.MIN_VALUE,ig.Timer.timeScale=1,ig.Timer.maxStep=.05,ig.Timer.step=function(){var t=Date.now(),e=(t-ig.Timer._last)/1e3;ig.Timer.time+=Math.min(e,ig.Timer.maxStep)*ig.Timer.timeScale,ig.Timer._last=t}}),ig.baked=!0,ig.module("impact.system").requires("impact.timer","impact.image").defines(function(){"use strict";ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:!1,delegate:null,clock:null,canvas:null,context:null,init:function(t,e,i,n,s){this.fps=e,this.clock=new ig.Timer,this.canvas=ig.$(t),this.resize(i,n,s),this.context=this.canvas.getContext("2d"),this.getDrawPos=ig.System.drawMode,1!=this.scale&&(ig.System.scaleMode=ig.System.SCALE.CRISP),ig.System.scaleMode(this.canvas,this.context)},resize:function(t,e,i){this.width=t,this.height=e,this.scale=i||this.scale,this.realWidth=this.width*this.scale,this.realHeight=this.height*this.scale,this.canvas.width=this.realWidth,this.canvas.height=this.realHeight},setGame:function(t){this.running?this.newGameClass=t:this.setGameNow(t)},setGameNow:function(t){ig.game=new t,ig.system.setDelegate(ig.game)},setDelegate:function(t){if("function"!=typeof t.run)throw"System.setDelegate: No run() function in object";this.delegate=t,this.startRunLoop()},stopRunLoop:function(){ig.clearAnimation(this.animationId),this.running=!1},startRunLoop:function(){this.stopRunLoop(),this.animationId=ig.setAnimation(this.run.bind(this),this.canvas),this.running=!0},clear:function(t){this.context.fillStyle=t,this.context.fillRect(0,0,this.realWidth,this.realHeight)},run:function(){ig.Timer.step(),this.tick=this.clock.tick(),this.delegate.run(),ig.input.clearPressed(),this.newGameClass&&(this.setGameNow(this.newGameClass),this.newGameClass=null)},getDrawPos:null}),ig.System.DRAW={AUTHENTIC:function(t){return Math.round(t)*this.scale},SMOOTH:function(t){return Math.round(t*this.scale)},SUBPIXEL:function(t){return t*this.scale}},ig.System.drawMode=ig.System.DRAW.SMOOTH,ig.System.SCALE={CRISP:function(t,e){ig.setVendorAttribute(e,"imageSmoothingEnabled",!1),t.style.imageRendering="-moz-crisp-edges",t.style.imageRendering="-o-crisp-edges",t.style.imageRendering="-webkit-optimize-contrast",t.style.imageRendering="crisp-edges",t.style.msInterpolationMode="nearest-neighbor"},SMOOTH:function(t,e){ig.setVendorAttribute(e,"imageSmoothingEnabled",!0),t.style.imageRendering="",t.style.msInterpolationMode=""}},ig.System.scaleMode=ig.System.SCALE.SMOOTH}),ig.baked=!0,ig.module("impact.input").defines(function(){"use strict";ig.KEY={MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190},ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:!1,isUsingKeyboard:!1,isUsingAccelerometer:!1,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){if(!this.isUsingMouse){this.isUsingMouse=!0;var t=this.mousewheel.bind(this);ig.system.canvas.addEventListener("mousewheel",t,!1),ig.system.canvas.addEventListener("DOMMouseScroll",t,!1),ig.system.canvas.addEventListener("contextmenu",this.contextmenu.bind(this),!1),ig.system.canvas.addEventListener("mousedown",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("mouseup",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("mousemove",this.mousemove.bind(this),!1),ig.ua.touchDevice&&(ig.system.canvas.addEventListener("touchstart",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("touchend",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("touchmove",this.mousemove.bind(this),!1),ig.system.canvas.addEventListener("MSPointerDown",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("MSPointerUp",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("MSPointerMove",this.mousemove.bind(this),!1),ig.system.canvas.style.msTouchAction="none")}},initKeyboard:function(){this.isUsingKeyboard||(this.isUsingKeyboard=!0,window.addEventListener("keydown",this.keydown.bind(this),!1),window.addEventListener("keyup",this.keyup.bind(this),!1))},initAccelerometer:function(){this.isUsingAccelerometer||window.addEventListener("devicemotion",this.devicemotion.bind(this),!1)},mousewheel:function(t){var e=t.wheelDelta?t.wheelDelta:-1*t.detail,i=e>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN,n=this.bindings[i];n&&(this.actions[n]=!0,this.presses[n]=!0,this.delayedKeyup[n]=!0,t.stopPropagation(),t.preventDefault())},mousemove:function(t){var e=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth,i=ig.system.scale*(e/ig.system.realWidth),n={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(n=ig.system.canvas.getBoundingClientRect());var s=t.touches?t.touches[0]:t;this.mouse.x=(s.clientX-n.left)/i,this.mouse.y=(s.clientY-n.top)/i},contextmenu:function(t){this.bindings[ig.KEY.MOUSE2]&&(t.stopPropagation(),t.preventDefault())},keydown:function(t){var e=t.target.tagName;if("INPUT"!=e&&"TEXTAREA"!=e){var i="keydown"==t.type?t.keyCode:2==t.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1;("touchstart"==t.type||"mousedown"==t.type)&&this.mousemove(t);var n=this.bindings[i];n&&(this.actions[n]=!0,this.locks[n]||(this.presses[n]=!0,this.locks[n]=!0),t.stopPropagation(),t.preventDefault())}},keyup:function(t){var e=t.target.tagName;if("INPUT"!=e&&"TEXTAREA"!=e){var i="keyup"==t.type?t.keyCode:2==t.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1,n=this.bindings[i];n&&(this.delayedKeyup[n]=!0,t.stopPropagation(),t.preventDefault())}},devicemotion:function(t){this.accel=t.accelerationIncludingGravity},bind:function(t,e){0>t?this.initMouse():t>0&&this.initKeyboard(),this.bindings[t]=e},bindTouch:function(t,e){var i=ig.$(t),n=this;i.addEventListener("touchstart",function(t){n.touchStart(t,e)},!1),i.addEventListener("touchend",function(t){n.touchEnd(t,e)},!1),i.addEventListener("MSPointerDown",function(t){n.touchStart(t,e)},!1),i.addEventListener("MSPointerUp",function(t){n.touchEnd(t,e)},!1)},unbind:function(t){var e=this.bindings[t];this.delayedKeyup[e]=!0,this.bindings[t]=null},unbindAll:function(){this.bindings={},this.actions={},this.presses={},this.locks={},this.delayedKeyup={}},state:function(t){return this.actions[t]},pressed:function(t){return this.presses[t]},released:function(t){return this.delayedKeyup[t]},clearPressed:function(){for(var t in this.delayedKeyup)this.actions[t]=!1,this.locks[t]=!1;this.delayedKeyup={},this.presses={}},touchStart:function(t,e){return this.actions[e]=!0,this.presses[e]=!0,t.stopPropagation(),t.preventDefault(),!1},touchEnd:function(t,e){return this.delayedKeyup[e]=!0,t.stopPropagation(),t.preventDefault(),!1}})}),ig.baked=!0,ig.module("impact.impact").requires("dom.ready","impact.loader","impact.system","impact.input","impact.sound").defines(function(){"use strict";ig.main=function(t,e,i,n,s,a,o){ig.system=new ig.System(t,i,n,s,a||1),ig.input=new ig.Input,ig.soundManager=new ig.SoundManager,ig.music=new ig.Music,ig.ready=!0;var r=new(o||ig.Loader)(e,ig.resources);r.load()}}),ig.baked=!0,ig.module("impact.animation").requires("impact.timer","impact.image").defines(function(){"use strict";ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(t,e,i){this.width=e,this.height=i,this.image=new ig.Image(t)}}),ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:!1,y:!1},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(t,e,i,n){this.sheet=t,this.pivot={x:t.width/2,y:t.height/2},this.timer=new ig.Timer,this.frameTime=e,this.sequence=i,this.stop=!!n,this.tile=this.sequence[0]},rewind:function(){return this.timer.set(),this.loopCount=0,this.tile=this.sequence[0],this},gotoFrame:function(t){this.timer.set(this.frameTime*-t),this.update()},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var t=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(t/this.sequence.length),this.frame=this.stop&&this.loopCount>0?this.sequence.length-1:t%this.sequence.length,this.tile=this.sequence[this.frame]},draw:function(t,e){var i=Math.max(this.sheet.width,this.sheet.height);t>ig.system.width||e>ig.system.height||0>t+i||0>e+i||(1!=this.alpha&&(ig.system.context.globalAlpha=this.alpha),0==this.angle?this.sheet.image.drawTile(t,e,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y):(ig.system.context.save(),ig.system.context.translate(ig.system.getDrawPos(t+this.pivot.x),ig.system.getDrawPos(e+this.pivot.y)),ig.system.context.rotate(this.angle),this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y),ig.system.context.restore()),1!=this.alpha&&(ig.system.context.globalAlpha=1))}})}),ig.baked=!0,ig.module("impact.entity").requires("impact.animation","impact.impact").defines(function(){"use strict";ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:!1,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:!1,slopeStanding:{min:44..toRad(),max:136..toRad()},init:function(t,e,i){this.id=++ig.Entity._lastId,this.pos.x=t,this.pos.y=e,ig.merge(this,i)},addAnim:function(t,e,i,n){if(!this.animSheet)throw"No animSheet to add the animation "+t+" to.";var s=new ig.Animation(this.animSheet,e,i,n);return this.anims[t]=s,this.currentAnim||(this.currentAnim=s),s},update:function(){this.last.x=this.pos.x,this.last.y=this.pos.y,this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor,this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x),this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var t=this.vel.x*ig.system.tick,e=this.vel.y*ig.system.tick,i=ig.game.collisionMap.trace(this.pos.x,this.pos.y,t,e,this.size.x,this.size.y);this.handleMovementTrace(i),this.currentAnim&&this.currentAnim.update()},getNewVelocity:function(t,e,i,n){if(e)return(t+e*ig.system.tick).limit(-n,n);if(i){var s=i*ig.system.tick;return t-s>0?t-s:0>t+s?t+s:0}return t.limit(-n,n)},handleMovementTrace:function(t){if(this.standing=!1,t.collision.y&&(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity?this.vel.y*=-this.bounciness:(this.vel.y>0&&(this.standing=!0),this.vel.y=0)),t.collision.x&&(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity?this.vel.x*=-this.bounciness:this.vel.x=0),t.collision.slope){var e=t.collision.slope;if(this.bounciness>0){var i=this.vel.x*e.nx+this.vel.y*e.ny;this.vel.x=(this.vel.x-2*e.nx*i)*this.bounciness,this.vel.y=(this.vel.y-2*e.ny*i)*this.bounciness}else{var n=e.x*e.x+e.y*e.y,s=(this.vel.x*e.x+this.vel.y*e.y)/n;this.vel.x=e.x*s,this.vel.y=e.y*s;var a=Math.atan2(e.x,e.y);a>this.slopeStanding.min&&a<this.slopeStanding.max&&(this.standing=!0)}}this.pos=t.pos},draw:function(){this.currentAnim&&this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y)},kill:function(){ig.game.removeEntity(this)},receiveDamage:function(t){this.health-=t,this.health<=0&&this.kill()},touches:function(t){return!(this.pos.x>=t.pos.x+t.size.x||this.pos.x+this.size.x<=t.pos.x||this.pos.y>=t.pos.y+t.size.y||this.pos.y+this.size.y<=t.pos.y)},distanceTo:function(t){var e=this.pos.x+this.size.x/2-(t.pos.x+t.size.x/2),i=this.pos.y+this.size.y/2-(t.pos.y+t.size.y/2);return Math.sqrt(e*e+i*i)},angleTo:function(t){return Math.atan2(t.pos.y+t.size.y/2-(this.pos.y+this.size.y/2),t.pos.x+t.size.x/2-(this.pos.x+this.size.x/2))},check:function(){},collideWith:function(){},ready:function(){}}),ig.Entity._lastId=0,ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8},ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3},ig.Entity.checkPair=function(t,e){t.checkAgainst&e.type&&t.check(e),e.checkAgainst&t.type&&e.check(t),t.collides&&e.collides&&t.collides+e.collides>ig.Entity.COLLIDES.ACTIVE&&ig.Entity.solveCollision(t,e)},ig.Entity.solveCollision=function(t,e){var i=null;t.collides==ig.Entity.COLLIDES.LITE||e.collides==ig.Entity.COLLIDES.FIXED?i=t:(e.collides==ig.Entity.COLLIDES.LITE||t.collides==ig.Entity.COLLIDES.FIXED)&&(i=e),t.last.x+t.size.x>e.last.x&&t.last.x<e.last.x+e.size.x?(t.last.y<e.last.y?ig.Entity.seperateOnYAxis(t,e,i):ig.Entity.seperateOnYAxis(e,t,i),t.collideWith(e,"y"),e.collideWith(t,"y")):t.last.y+t.size.y>e.last.y&&t.last.y<e.last.y+e.size.y&&(t.last.x<e.last.x?ig.Entity.seperateOnXAxis(t,e,i):ig.Entity.seperateOnXAxis(e,t,i),t.collideWith(e,"x"),e.collideWith(t,"x"))},ig.Entity.seperateOnXAxis=function(t,e,i){var n=t.pos.x+t.size.x-e.pos.x;if(i){var s=t===i?e:t;i.vel.x=-i.vel.x*i.bounciness+s.vel.x;var a=ig.game.collisionMap.trace(i.pos.x,i.pos.y,i==t?-n:n,0,i.size.x,i.size.y);i.pos.x=a.pos.x}else{var o=(t.vel.x-e.vel.x)/2;t.vel.x=-o,e.vel.x=o;var r=ig.game.collisionMap.trace(t.pos.x,t.pos.y,-n/2,0,t.size.x,t.size.y);t.pos.x=Math.floor(r.pos.x);var l=ig.game.collisionMap.trace(e.pos.x,e.pos.y,n/2,0,e.size.x,e.size.y);e.pos.x=Math.ceil(l.pos.x)}},ig.Entity.seperateOnYAxis=function(t,e,i){var n=t.pos.y+t.size.y-e.pos.y;if(i){var s=t===i?e:t;i.vel.y=-i.vel.y*i.bounciness+s.vel.y;var a=0;i==t&&Math.abs(i.vel.y-s.vel.y)<i.minBounceVelocity&&(i.standing=!0,a=s.vel.x*ig.system.tick);
var o=ig.game.collisionMap.trace(i.pos.x,i.pos.y,a,i==t?-n:n,i.size.x,i.size.y);i.pos.y=o.pos.y,i.pos.x=o.pos.x}else if(ig.game.gravity&&(e.standing||t.vel.y>0)){var r=ig.game.collisionMap.trace(t.pos.x,t.pos.y,0,-(t.pos.y+t.size.y-e.pos.y),t.size.x,t.size.y);t.pos.y=r.pos.y,t.bounciness>0&&t.vel.y>t.minBounceVelocity?t.vel.y*=-t.bounciness:(t.standing=!0,t.vel.y=0)}else{var l=(t.vel.y-e.vel.y)/2;t.vel.y=-l,e.vel.y=l;var a=e.vel.x*ig.system.tick,r=ig.game.collisionMap.trace(t.pos.x,t.pos.y,a,-n/2,t.size.x,t.size.y);t.pos.y=r.pos.y;var h=ig.game.collisionMap.trace(e.pos.x,e.pos.y,0,n/2,e.size.x,e.size.y);e.pos.y=h.pos.y}}}),ig.baked=!0,ig.module("impact.map").defines(function(){"use strict";ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(t,e){this.tilesize=t,this.data=e,this.height=e.length,this.width=e[0].length},getTile:function(t,e){var i=Math.floor(t/this.tilesize),n=Math.floor(e/this.tilesize);return i>=0&&i<this.width&&n>=0&&n<this.height?this.data[n][i]:0},setTile:function(t,e,i){var n=Math.floor(t/this.tilesize),s=Math.floor(e/this.tilesize);n>=0&&n<this.width&&s>=0&&s<this.height&&(this.data[s][n]=i)}})}),ig.baked=!0,ig.module("impact.collision-map").requires("impact.map").defines(function(){"use strict";ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(t,e,i){this.parent(t,e),this.tiledef=i||ig.CollisionMap.defaultTileDef;for(var n in this.tiledef)n|0>this.lastSlope&&(this.lastSlope=0|n)},trace:function(t,e,i,n,s,a){var o={collision:{x:!1,y:!1,slope:!1},pos:{x:t,y:e},tile:{x:0,y:0}},r=Math.ceil(Math.max(Math.abs(i),Math.abs(n))/this.tilesize);if(r>1)for(var l=i/r,h=n/r,c=0;r>c&&(l||h)&&(this._traceStep(o,t,e,l,h,s,a,i,n,c),t=o.pos.x,e=o.pos.y,o.collision.x&&(l=0,i=0),o.collision.y&&(h=0,n=0),!o.collision.slope);c++);else this._traceStep(o,t,e,i,n,s,a,i,n,0);return o},_traceStep:function(t,e,i,n,s,a,o,r,l,h){t.pos.x+=n,t.pos.y+=s;var c=0;if(n){var d=n>0?a:0,u=0>n?this.tilesize:0,g=Math.max(Math.floor(i/this.tilesize),0),p=Math.min(Math.ceil((i+o)/this.tilesize),this.height),m=Math.floor((t.pos.x+d)/this.tilesize),f=Math.floor((e+d)/this.tilesize);if((h>0||m==f||0>f||f>=this.width)&&(f=-1),m>=0&&m<this.width)for(var y=g;p>y&&!(-1!=f&&(c=this.data[y][f],c>1&&c<=this.lastSlope&&this._checkTileDef(t,c,e,i,r,l,a,o,f,y)));y++)if(c=this.data[y][m],1==c||c>this.lastSlope||c>1&&this._checkTileDef(t,c,e,i,r,l,a,o,m,y)){if(c>1&&c<=this.lastSlope&&t.collision.slope)break;t.collision.x=!0,t.tile.x=c,e=t.pos.x=m*this.tilesize-d+u,r=0;break}}if(s){var v=s>0?o:0,b=0>s?this.tilesize:0,x=Math.max(Math.floor(t.pos.x/this.tilesize),0),w=Math.min(Math.ceil((t.pos.x+a)/this.tilesize),this.width),y=Math.floor((t.pos.y+v)/this.tilesize),k=Math.floor((i+v)/this.tilesize);if((h>0||y==k||0>k||k>=this.height)&&(k=-1),y>=0&&y<this.height)for(var m=x;w>m&&!(-1!=k&&(c=this.data[k][m],c>1&&c<=this.lastSlope&&this._checkTileDef(t,c,e,i,r,l,a,o,m,k)));m++)if(c=this.data[y][m],1==c||c>this.lastSlope||c>1&&this._checkTileDef(t,c,e,i,r,l,a,o,m,y)){if(c>1&&c<=this.lastSlope&&t.collision.slope)break;t.collision.y=!0,t.tile.y=c,t.pos.y=y*this.tilesize-v+b;break}}},_checkTileDef:function(t,e,i,n,s,a,o,r,l,h){var c=this.tiledef[e];if(!c)return!1;var d=(l+c[0])*this.tilesize,u=(h+c[1])*this.tilesize,g=(c[2]-c[0])*this.tilesize,p=(c[3]-c[1])*this.tilesize,m=c[4],f=i+s+(0>p?o:0)-d,y=n+a+(g>0?r:0)-u;if(g*y-p*f>0){if(0>s*-p+a*g)return m;var v=Math.sqrt(g*g+p*p),b=p/v,x=-g/v,w=f*b+y*x,k=b*w,_=x*w;return k*k+_*_>=s*s+a*a?m||.5>g*(y-a)-p*(f-s):(t.pos.x=i+s-k,t.pos.y=n+a-_,t.collision.slope={x:g,y:p,nx:b,ny:x},!0)}return!1}});var t=.5,e=1/3,i=2/3,n=!0,s=!1;ig.CollisionMap.defaultTileDef={5:[0,1,1,i,n],6:[0,i,1,e,n],7:[0,e,1,0,n],3:[0,1,1,t,n],4:[0,t,1,0,n],2:[0,1,1,0,n],10:[t,1,1,0,n],21:[0,1,t,0,n],32:[i,1,1,0,n],43:[e,1,i,0,n],54:[0,1,e,0,n],27:[0,0,1,e,n],28:[0,e,1,i,n],29:[0,i,1,1,n],25:[0,0,1,t,n],26:[0,t,1,1,n],24:[0,0,1,1,n],11:[0,0,t,1,n],22:[t,0,1,1,n],33:[0,0,e,1,n],44:[e,0,i,1,n],55:[i,0,1,1,n],16:[1,e,0,0,n],17:[1,i,0,e,n],18:[1,1,0,i,n],14:[1,t,0,0,n],15:[1,1,0,t,n],13:[1,1,0,0,n],8:[t,1,0,0,n],19:[1,1,t,0,n],30:[e,1,0,0,n],41:[i,1,e,0,n],52:[1,1,i,0,n],38:[1,i,0,1,n],39:[1,e,0,i,n],40:[1,0,0,e,n],36:[1,t,0,1,n],37:[1,0,0,t,n],35:[1,0,0,1,n],9:[1,0,t,1,n],20:[t,0,0,1,n],31:[1,0,i,1,n],42:[i,0,e,1,n],53:[e,0,0,1,n],12:[0,0,1,0,s],23:[1,1,0,1,s],34:[1,0,1,1,s],45:[0,1,0,0,s]},ig.CollisionMap.staticNoCollision={trace:function(t,e,i,n){return{collision:{x:!1,y:!1,slope:!1},pos:{x:t+i,y:e+n},tile:{x:0,y:0}}}}}),ig.baked=!0,ig.module("impact.background-map").requires("impact.map","impact.image").defines(function(){"use strict";ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:!1,tilesetName:"",foreground:!1,enabled:!0,preRender:!1,preRenderedChunks:null,chunkSize:512,debugChunks:!1,anims:{},init:function(t,e,i){this.parent(t,e),this.setTileset(i)},setTileset:function(t){this.tilesetName=t instanceof ig.Image?t.path:t,this.tiles=new ig.Image(this.tilesetName),this.preRenderedChunks=null},setScreenPos:function(t,e){this.scroll.x=t/this.distance,this.scroll.y=e/this.distance},preRenderMapToChunks:function(){var t=this.width*this.tilesize*ig.system.scale,e=this.height*this.tilesize*ig.system.scale;this.chunkSize=Math.min(Math.max(t,e),this.chunkSize);var i=Math.ceil(t/this.chunkSize),n=Math.ceil(e/this.chunkSize);this.preRenderedChunks=[];for(var s=0;n>s;s++){this.preRenderedChunks[s]=[];for(var a=0;i>a;a++){var o=a==i-1?t-a*this.chunkSize:this.chunkSize,r=s==n-1?e-s*this.chunkSize:this.chunkSize;this.preRenderedChunks[s][a]=this.preRenderChunk(a,s,o,r)}}},preRenderChunk:function(t,e,i,n){var s=i/this.tilesize/ig.system.scale+1,a=n/this.tilesize/ig.system.scale+1,o=t*this.chunkSize/ig.system.scale%this.tilesize,r=e*this.chunkSize/ig.system.scale%this.tilesize,l=Math.floor(t*this.chunkSize/this.tilesize/ig.system.scale),h=Math.floor(e*this.chunkSize/this.tilesize/ig.system.scale),c=ig.$new("canvas");c.width=i,c.height=n;var d=ig.system.context;ig.system.context=c.getContext("2d");for(var u=0;s>u;u++)for(var g=0;a>g;g++)if(u+l<this.width&&g+h<this.height){var p=this.data[g+h][u+l];p&&this.tiles.drawTile(u*this.tilesize-o,g*this.tilesize-r,p-1,this.tilesize)}return ig.system.context=d,c},draw:function(){this.tiles.loaded&&this.enabled&&(this.preRender?this.drawPreRendered():this.drawTiled())},drawPreRendered:function(){this.preRenderedChunks||this.preRenderMapToChunks();var t=ig.system.getDrawPos(this.scroll.x),e=ig.system.getDrawPos(this.scroll.y);if(this.repeat){var i=this.width*this.tilesize*ig.system.scale;t=(t%i+i)%i;var n=this.height*this.tilesize*ig.system.scale;e=(e%n+n)%n}var s=Math.max(Math.floor(t/this.chunkSize),0),a=Math.max(Math.floor(e/this.chunkSize),0),o=Math.ceil((t+ig.system.realWidth)/this.chunkSize),r=Math.ceil((e+ig.system.realHeight)/this.chunkSize),l=this.preRenderedChunks[0].length,h=this.preRenderedChunks.length;this.repeat||(o=Math.min(o,l),r=Math.min(r,h));for(var c=0,d=a;r>d;d++){for(var u=0,g=s;o>g;g++){var p=this.preRenderedChunks[d%h][g%l],m=-t+g*this.chunkSize-u,f=-e+d*this.chunkSize-c;ig.system.context.drawImage(p,m,f),ig.Image.drawCount++,this.debugChunks&&(ig.system.context.strokeStyle="#f0f",ig.system.context.strokeRect(m,f,this.chunkSize,this.chunkSize)),this.repeat&&p.width<this.chunkSize&&m+p.width<ig.system.realWidth&&(u+=this.chunkSize-p.width,o++)}this.repeat&&p.height<this.chunkSize&&f+p.height<ig.system.realHeight&&(c+=this.chunkSize-p.height,r++)}},drawTiled:function(){for(var t=0,e=null,i=(this.scroll.x/this.tilesize).toInt(),n=(this.scroll.y/this.tilesize).toInt(),s=this.scroll.x%this.tilesize,a=this.scroll.y%this.tilesize,o=-s-this.tilesize,r=-a-this.tilesize,l=ig.system.width+this.tilesize-s,h=ig.system.height+this.tilesize-a,c=-1,d=r;h>d;c++,d+=this.tilesize){var u=c+n;if(u>=this.height||0>u){if(!this.repeat)continue;u=(u%this.height+this.height)%this.height}for(var g=-1,p=o;l>p;g++,p+=this.tilesize){var m=g+i;if(m>=this.width||0>m){if(!this.repeat)continue;m=(m%this.width+this.width)%this.width}(t=this.data[u][m])&&((e=this.anims[t-1])?e.draw(p,d):this.tiles.drawTile(p,d,t-1,this.tilesize))}}}})}),ig.baked=!0,ig.module("impact.game").requires("impact.impact","impact.entity","impact.collision-map","impact.background-map").defines(function(){"use strict";ig.Game=ig.Class.extend({clearColor:"#000000",gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:!1,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:!1,staticInstantiate:function(){return this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX,ig.game=this,null},loadLevel:function(t){this.screen={x:0,y:0},this.entities=[],this.namedEntities={};for(var e=0;e<t.entities.length;e++){var i=t.entities[e];this.spawnEntity(i.type,i.x,i.y,i.settings)}this.sortEntities(),this.collisionMap=ig.CollisionMap.staticNoCollision,this.backgroundMaps=[];for(var e=0;e<t.layer.length;e++){var n=t.layer[e];if("collision"==n.name)this.collisionMap=new ig.CollisionMap(n.tilesize,n.data);else{var s=new ig.BackgroundMap(n.tilesize,n.data,n.tilesetName);s.anims=this.backgroundAnims[n.tilesetName]||{},s.repeat=n.repeat,s.distance=n.distance,s.foreground=!!n.foreground,s.preRender=!!n.preRender,s.name=n.name,this.backgroundMaps.push(s)}}for(var e=0;e<this.entities.length;e++)this.entities[e].ready()},loadLevelDeferred:function(t){this._levelToLoad=t},getMapByName:function(t){if("collision"==t)return this.collisionMap;for(var e=0;e<this.backgroundMaps.length;e++)if(this.backgroundMaps[e].name==t)return this.backgroundMaps[e];return null},getEntityByName:function(t){return this.namedEntities[t]},getEntitiesByType:function(t){for(var e="string"==typeof t?ig.global[t]:t,i=[],n=0;n<this.entities.length;n++){var s=this.entities[n];s instanceof e&&!s._killed&&i.push(s)}return i},spawnEntity:function(t,e,i,n){var s="string"==typeof t?ig.global[t]:t;if(!s)throw"Can't spawn entity of type "+t;var a=new s(e,i,n||{});return this.entities.push(a),a.name&&(this.namedEntities[a.name]=a),a},sortEntities:function(){this.entities.sort(this.sortBy)},sortEntitiesDeferred:function(){this._doSortEntities=!0},removeEntity:function(t){t.name&&delete this.namedEntities[t.name],t._killed=!0,t.type=ig.Entity.TYPE.NONE,t.checkAgainst=ig.Entity.TYPE.NONE,t.collides=ig.Entity.COLLIDES.NEVER,this._deferredKill.push(t)},run:function(){this.update(),this.draw()},update:function(){this._levelToLoad&&(this.loadLevel(this._levelToLoad),this._levelToLoad=null),(this._doSortEntities||this.autoSort)&&(this.sortEntities(),this._doSortEntities=!1),this.updateEntities(),this.checkEntities();for(var t=0;t<this._deferredKill.length;t++)this.entities.erase(this._deferredKill[t]);this._deferredKill=[];for(var e in this.backgroundAnims){var i=this.backgroundAnims[e];for(var n in i)i[n].update()}},updateEntities:function(){for(var t=0;t<this.entities.length;t++){var e=this.entities[t];e._killed||e.update()}},draw:function(){this.clearColor&&ig.system.clear(this.clearColor),this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale,this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var t;for(t=0;t<this.backgroundMaps.length;t++){var e=this.backgroundMaps[t];if(e.foreground)break;e.setScreenPos(this.screen.x,this.screen.y),e.draw()}for(this.drawEntities(),t;t<this.backgroundMaps.length;t++){var e=this.backgroundMaps[t];e.setScreenPos(this.screen.x,this.screen.y),e.draw()}},drawEntities:function(){for(var t=0;t<this.entities.length;t++)this.entities[t].draw()},checkEntities:function(){for(var t={},e=0;e<this.entities.length;e++){var i=this.entities[e];if(i.type!=ig.Entity.TYPE.NONE||i.checkAgainst!=ig.Entity.TYPE.NONE||i.collides!=ig.Entity.COLLIDES.NEVER)for(var n={},s=Math.floor(i.pos.x/this.cellSize),a=Math.floor(i.pos.y/this.cellSize),o=Math.floor((i.pos.x+i.size.x)/this.cellSize)+1,r=Math.floor((i.pos.y+i.size.y)/this.cellSize)+1,l=s;o>l;l++)for(var h=a;r>h;h++)if(t[l])if(t[l][h]){for(var c=t[l][h],d=0;d<c.length;d++)i.touches(c[d])&&!n[c[d].id]&&(n[c[d].id]=!0,ig.Entity.checkPair(i,c[d]));c.push(i)}else t[l][h]=[i];else t[l]={},t[l][h]=[i]}}}),ig.Game.SORT={Z_INDEX:function(t,e){return t.zIndex-e.zIndex},POS_X:function(t,e){return t.pos.x+t.size.x-(e.pos.x+e.size.x)},POS_Y:function(t,e){return t.pos.y+t.size.y-(e.pos.y+e.size.y)}}}),ig.baked=!0,ig.module("game.entities.particle").requires("impact.entity").defines(function(){EntityParticle=ig.Entity.extend({size:{x:4,y:4},offset:{x:0,y:0},maxVel:{x:160,y:160},minBounceVelocity:0,type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,collides:ig.Entity.COLLIDES.LITE,lifetime:5,fadetime:1,bounciness:.6,friction:{x:20,y:0}})}),ig.baked=!0,ig.module("game.entities.bloodParticle").requires("game.entities.particle").defines(function(){EntityBloodParticle=EntityParticle.extend({alpha:1,lifetime:.5,fadetime:.4,bounciness:.1,friction:{x:100,y:100},zIndex:0,maxVel:{x:500,y:500},gravityFactor:.5,init:function(t,e,i){this.pos.x=t,this.pos.y=e,this.vel.x=i.dx/20*Math.random()/.3,this.vel.y=i.dy/20*Math.random()/.3,this.particleSize=5*Math.random(),this.idleTimer=new ig.Timer},update:function(){return this.idleTimer.delta()>this.lifetime?(this.kill(),void 0):(this.alpha=this.idleTimer.delta().map(this.lifetime-this.fadetime,this.lifetime,1,0),this.parent(),void 0)},draw:function(){this.parent();var t=this.pos.x-ig.game.screen.x,e=this.pos.y-ig.game.screen.y;ig.system.context.beginPath(),ig.system.context.arc(t,e,this.particleSize,0,2*Math.PI,!0),ig.system.context.fillStyle="rgba(255,0,0,"+this.alpha+")",ig.system.context.fill()}})}),ig.baked=!0,ig.module("game.entities.ashParticle").requires("game.entities.particle").defines(function(){EntityAshParticle=EntityParticle.extend({alpha:1,lifetime:1,fadetime:.4,bounciness:.1,friction:{x:100,y:100},zIndex:0,maxVel:{x:500,y:500},gravityFactor:.5,init:function(t,e,i){this.pos.x=t+Math.floor(Math.random()*i.width),this.pos.y=e+Math.floor(Math.random()*i.height),this.color=Math.floor(255*Math.random()),this.particleSize=5*Math.random(),this.idleTimer=new ig.Timer},update:function(){return this.idleTimer.delta()>this.lifetime?(this.kill(),void 0):(this.alpha=this.idleTimer.delta().map(this.lifetime-this.fadetime,this.lifetime,1,0),this.parent(),void 0)},draw:function(){this.parent();var t=this.pos.x-ig.game.screen.x,e=this.pos.y-ig.game.screen.y;ig.system.context.beginPath(),ig.system.context.arc(t,e,this.particleSize,0,2*Math.PI,!0),ig.system.context.fillStyle="rgba("+this.color+","+this.color+","+this.color+","+this.alpha+")",ig.system.context.fill()}})}),ig.baked=!0,ig.module("game.entities.character").requires("impact.entity").defines(function(){EntityCharacter=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,collides:ig.Entity.COLLIDES.NONE})}),ig.baked=!0,ig.module("game.entities.player").requires("game.entities.character").defines(function(){EntityPlayer=EntityCharacter.extend({size:{x:32,y:64},maxVel:{x:400,y:400},friction:{x:500,y:0},animSheet:new ig.AnimationSheet("media/player.png",32,64),gunshot:new ig.Sound("media/sound/gun.*"),type:ig.Entity.TYPE.A,collides:ig.Entity.COLLIDES.PASSIVE,flip:!1,accelGround:400,accelAir:200,jump:300,health:100,maxHealth:100,cooldown:40,zIndex:0,init:function(t,e,i){this.parent(t,e,i),ig.global.wm||(this.arm=ig.game.spawnEntity(EntityArm,this.pos.x,this.pos.y,{attachee:this})),this.addAnim("idle",.5,[0,1,2,3]),this.addAnim("run",.25,[4,5,6,7,8,9])},update:function(){var t=this.standing?this.accelGround:this.accelAir;ig.input.state("left")?(this.accel.x=-t,this.flip=!0):ig.input.state("right")?(this.accel.x=t,this.flip=!1):this.accel.x=0,this.standing&&ig.input.state("jump")&&(this.vel.y=-this.jump),ig.input.state("shoot")&&0==this.cooldown&&(ig.game.spawnEntity(EntityBullet,this.pos.x+this.size.x/2,this.pos.y+this.size.y/2,{flip:this.flip,d:{x:ig.input.mouse.x,y:ig.input.mouse.y}}),this.gunshot.play(),this.cooldown=20,this.arm.fire()),this.currentAnim=this.vel.y<0?this.anims.run:this.vel.y>0?this.anims.run:0!=this.vel.x?this.anims.run:this.anims.idle,this.currentAnim.flip.x=this.flip,this.cooldown>0&&this.cooldown--,this.parent(),this.arm.attacheeUpdate(this.pos.x,this.pos.y,this.flip);var e=ig.game.collisionMap;this.pos.y>e.height*e.tilesize+400&&(ig.music.stop(),ig.game.loadLevelDeferred(LevelMainMenu))},receiveDamage:function(t,e){this.health-t<=0&&(ig.music.stop(),ig.game.loadLevelDeferred(LevelMainMenu)),this.parent(t,e)},healthPowerup:function(t){this.health+=t}}),EntityArm=ig.Entity.extend({animSheet:new ig.AnimationSheet("media/arm.png",32,8),size:{x:32,y:8},type:ig.Entity.TYPE.NONE,collides:ig.Entity.COLLIDES.NONE,gravityFactor:0,zIndex:1,firingAnimCD:0,receiveDamage:function(t,e){this.attachedTo.receiveDamage(t,e)},init:function(t,e,i){this.parent(t,e,i),this.pos.x=t,this.pos.y=e,this.attachedTo=i.attachee,this.addAnim("notShooting",1,[0]),this.addAnim("shooting",1,[1])},update:function(){this.currentAnim.flip.x=this.flip,this.firingAnimCD-=1,this.currentAnim=this.firingAnimCD<0?this.anims.notShooting:this.anims.shooting;var t=Math.atan2(ig.input.mouse.y-this.pos.y+ig.game.screen.y,ig.input.mouse.x-this.pos.x+ig.game.screen.x);this.flip?(this.pos.x-=this.attachedTo.size.x-10,this.currentAnim.pivot.x=this.size.x,t+=Math.PI):this.currentAnim.pivot.x=0,this.currentAnim.angle=t,this.parent()},attacheeUpdate:function(t,e,i){this.pos={x:t+10,y:e+25},this.flip=i},fire:function(){this.firingAnimCD=10},draw:function(){this.parent()}}),EntityBullet=ig.Entity.extend({size:{x:8,y:8},animSheet:new ig.AnimationSheet("media/bullet2.png",8,8),gravityFactor:0,type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.B,collides:ig.Entity.COLLIDES.PASSIVE,maxVel:{x:1e7,y:1e7},init:function(t,e,i){this.parent(t,e,i),this.pos.x=t,this.pos.y=e,this.vel.x=ig.game.screen.x+i.d.x-this.pos.x,this.vel.y=i.d.y+ig.game.screen.y-this.pos.y;var n=Math.sqrt(this.vel.x*this.vel.x+this.vel.y*this.vel.y);this.vel.x/=n,this.vel.y/=n,this.vel.x*=2e3,this.vel.y*=2e3,this.addAnim("idle",1,[0]),this.pos.y-=this.animSheet.height/2},handleMovementTrace:function(t){this.parent(t),(t.collision.x||t.collision.y||t.collision.slope)&&this.kill()},update:function(){var t=ig.game.collisionMap.width*ig.game.collisionMap.tilesize,e=ig.game.collisionMap.height*ig.game.collisionMap.tilesize;(this.pos.x>t+ig.system.width||this.pos.x<0-ig.system.width||this.pos.y>e+ig.system.height||this.pos.y<0-ig.system.height)&&this.kill(),this.parent()},check:function(t){t.receiveDamage(10,this);for(var e=0;40>e;e++)ig.game.spawnEntity(EntityBloodParticle,this.pos.x,this.pos.y,{dx:this.vel.x,dy:this.vel.y});this.kill()}})}),ig.baked=!0,ig.module("game.entities.playerL1").requires("game.entities.player").defines(function(){EntityPlayerL1=EntityPlayer.extend({sun:100,maxSun:100,sunSound:new ig.Sound("media/sound/sun.*"),sunSoundTrack:new ig.Music,sunSoundPlaying:!1,init:function(t,e,i){this.parent(t,e,i),ig.global.wm||(this.sunProp=ig.game.spawnEntity(EntitySun,this.pos.x,this.pos.y,{attachee:this}),this.sunSoundTrack.add(this.sunSound),this.sunSoundTrack.volume=1)},update:function(){if(this.parent(),ig.input.state("sun")&&this.sun>0){for(var t=700,e=ig.game.getEntitiesByType(EntityEnemySpider),i=0;i<e.length;i++)e[i].pos.x<this.pos.x+t&&e[i].pos.x>this.pos.x-t&&e[i].pos.y<this.pos.y+t&&e[i].pos.y>this.pos.y-t&&e[i].receiveSunDamage(.5,this);this.sun--,this.sunProp.active=!0,this.sunSoundPlaying||(this.sunSoundTrack.play(),this.sunSoundPlaying=!0)}else this.sunProp.active=!1,this.sunSoundPlaying&&(this.sunSoundTrack.stop(),this.sunSoundPlaying=!1);this.sunProp.attacheeUpdate(this.pos.x,this.pos.y,this.size.x,this.size.y)},triggeredBy:function(t,e){"winTrigger"==e.name&&(ig.music.stop(),ig.game.loadLevelDeferred(LevelWin))},sunPowerup:function(t){this.sun+=t}}),EntitySun=ig.Entity.extend({size:{x:64,y:16},type:ig.Entity.TYPE.NONE,collides:ig.Entity.COLLIDES.NONE,gravityFactor:0,zIndex:99999,active:!1,init:function(t,e,i){this.parent(t,e,i),this.pos.x=t,this.pos.y=e,this.attachedTo=i.attachee},attacheeUpdate:function(t,e,i,n){this.pos={x:t+i/2,y:e+n/2}},draw:function(){if(this.parent(),this.active){var t=this.attachedTo.pos.x-ig.game.screen.x+this.attachedTo.size.x/2,e=this.attachedTo.pos.y-ig.game.screen.y+this.attachedTo.size.y/2;ig.system.context.rect(0,0,ig.system.width,ig.system.height);var i=ig.system.context.createRadialGradient(t,e,40,t,e,1e3);i.addColorStop(0,"rgba(255,255,0,1)"),i.addColorStop(.1,"rgba(255,255,0,.3)"),i.addColorStop(1,"rgba(255,255,0,0)"),ig.system.context.fillStyle=i,ig.system.context.fill()}}})}),ig.baked=!0,ig.module("game.entities.levelLogic").requires("impact.entity").defines(function(){EntityLevelLogic=ig.Entity.extend({size:{x:64,y:64},_wmDrawBox:!0,_wmBoxColor:"rgba(0, 0, 255, 0.4)",paused:!1,ignorePause:!0,levelMusic:new ig.Sound("media/sound/loop_level1.*"),init:function(t,e,i){this.parent(t,e,i),ig.global.wm||(ig.game.spawnEntity(EntityHealthbar),ig.game.spawnEntity(EntityKeybinder),ig.music.add(this.levelMusic),ig.music.volume=.1,ig.music.play())},update:function(){this.parent(),ig.input.pressed("pause")&&(ig.game.togglePause(),this.paused?ig.music.play():ig.music.pause(),this.paused=!this.paused)}}),EntityHealthbar=ig.Entity.extend({_wmIgnore:!0,draw:function(){var t=ig.game.getEntitiesByType(EntityPlayer)[0];if(t){newhp=t.health,maxhp=t.maxHealth,newhp>maxhp&&(newhp=maxhp);var e=150,i=30,n=10,s=10,a=newhp/maxhp*e;ig.system.context.beginPath(),ig.system.context.rect(n,s,a,i),ig.system.context.fillStyle="red",ig.system.context.fill(),ig.system.context.beginPath(),ig.system.context.rect(n,s,e,i),ig.system.context.strokeStyle="black",ig.system.context.lineWidth=1,ig.system.context.stroke()}}}),EntityKeybinder=ig.Entity.extend({_wmIgnore:!0,init:function(){ig.input.bind(ig.KEY.A,"left"),ig.input.bind(ig.KEY.D,"right"),ig.input.bind(ig.KEY.W,"jump"),ig.input.bind(ig.KEY.MOUSE1,"shoot"),ig.input.bind(ig.KEY.ESC,"pause")}})}),ig.baked=!0,ig.module("game.entities.level1Logic").requires("game.entities.levelLogic").defines(function(){EntityLevel1Logic=EntityLevelLogic.extend({init:function(t,e,i){this.parent(t,e,i),ig.global.wm||ig.game.spawnEntity(EntitySunbar)}}),EntitySunbar=ig.Entity.extend({_wmIgnore:!0,draw:function(){var t=ig.game.getEntitiesByType(EntityPlayerL1)[0];if(t){newsp=t.sun,maxsp=t.maxSun,newsp>maxsp&&(newsp=maxsp);var e=150,i=30,n=170,s=10,a=newsp/maxsp*e;ig.system.context.beginPath(),ig.system.context.rect(n,s,a,i),ig.system.context.fillStyle="yellow",ig.system.context.fill(),ig.system.context.beginPath(),ig.system.context.rect(n,s,e,i),ig.system.context.strokeStyle="black",ig.system.context.lineWidth=1,ig.system.context.stroke()}}}),EntityKeybinder=ig.Entity.extend({_wmIgnore:!0,init:function(){ig.input.bind(ig.KEY.A,"left"),ig.input.bind(ig.KEY.D,"right"),ig.input.bind(ig.KEY.W,"jump"),ig.input.bind(ig.KEY.MOUSE1,"shoot"),ig.input.bind(ig.KEY.ESC,"pause"),ig.input.bind(ig.KEY.SPACE,"sun")}})}),ig.baked=!0,ig.module("game.entities.powerup").requires("impact.entity").defines(function(){EntityPowerup=ig.Entity.extend({type:ig.Entity.TYPE.NONE,collides:ig.Entity.COLLIDES.NONE,checkAgainst:ig.Entity.TYPE.A,maxX:0,maxY:5,minX:0,minY:-5,currX:0,currY:0,xUp:!1,yUp:!1,_wmIgnore:!0,size:{x:32,y:32},offset:{x:0,y:0},init:function(t,e,i){this.parent(t,e,i),this.addAnim("idle",1,[0]),this.currentAnim=this.anims.idle,this.startX=this.pos.x,this.startY=this.pos.y},update:function(){this.xUp?(this.currX++,this.currX>=this.maxX&&(this.xUp=!this.xUp)):(this.currX--,this.currX<=this.minX&&(this.xUp=!this.xUp)),this.yUp?(this.currY++,this.currY>=this.maxY&&(this.yUp=!this.yUp)):(this.currY--,this.currY<=this.minY&&(this.yUp=!this.yUp)),this.pos.x=this.startX+this.currX,this.pos.y=this.startY+this.currY,this.parent()}})}),ig.baked=!0,ig.module("game.entities.sunPowerup").requires("game.entities.powerup").defines(function(){EntitySunPowerup=EntityPowerup.extend({maxX:0,maxY:5,minX:0,minY:-5,currX:0,currY:0,_wmIgnore:!1,animSheet:new ig.AnimationSheet("media/sun.png",32,32),check:function(t){t.sunPowerup(50),this.kill()}})}),ig.baked=!0,ig.module("plugins.perpixel").requires("impact.impact","impact.image","impact.entity").defines(function(){ig.Image.inject({alphas:[],alphasLoaded:!1,loadAlphas:function(){var t=ig.$new("canvas");t.width=this.data.width,t.height=this.data.height;var e=t.getContext("2d");e.drawImage(this.data,0,0);for(var i=e.getImageData(0,0,this.data.width,this.data.height).data,n=0,s=4*this.data.width,a=this.data.height*s,o=3;a>o;o+=s)for(var r=0;s>r;r+=4)this.alphas[n++]=i[r+o]?!0:!1;this.alphasLoaded=!0},onload:function(t){this.alphasLoaded||this.loadAlphas(),this.parent(t)}}),ig.Entity.inject({touches:function(t){if(ig.global.wm||null===this.currentAnim||null===t.currentAnim)return this.parent(t);var e=this.pos.x.round(),i=this.pos.y.round(),n=t.pos.x.round(),s=t.pos.y.round(),a=Math.max(e,n),o=Math.min(e+this.size.x,n+t.size.x),r=Math.max(i,s),l=Math.min(i+this.size.y,s+t.size.y);if(a>=o||r>=l)return!1;for(var h=this.currentAnim.sheet.image.alphas,c=t.currentAnim.sheet.image.alphas,d=l-r,u=this.currentAnim.tile,g=this.currentAnim.sheet.width,p=this.currentAnim.sheet.height,m=this.currentAnim.sheet.image.width,f=~~(u*g)%m,y=~~(u*g/m)*p,v=t.currentAnim.tile,b=t.currentAnim.sheet.width,x=t.currentAnim.sheet.height,w=t.currentAnim.sheet.image.width,k=~~(v*b)%w,_=~~(v*b/w)*x,E=(r-i+y)*m,C=(r-s+_)*w,S=a-e+f,T=a-n+k,M=o-a;d--;){for(var A=M,P=S,I=T;A--;){if(h[E+P++]&&c[C+I])return!0;I++}E+=m,C+=w}return!1}})}),ig.baked=!0,ig.module("game.entities.enemySpider").requires("game.entities.character","plugins.perpixel").defines(function(){EntityEnemySpider=EntityCharacter.extend({type:ig.Entity.TYPE.B,checkAgainst:ig.Entity.TYPE.A,collides:ig.Entity.COLLIDES.PASSIVE,maxVel:{x:400,y:400},friction:{x:300,y:0},size:{x:64,y:64},offset:{x:0,y:0},speed:100,health:50,animSheet:new ig.AnimationSheet("media/spider.png",64,64),init:function(t,e,i){this.parent(t,e,i),this.addAnim("idle",1,[0]),this.addAnim("walk",.3,[0,1]),this.currentAnim=this.anims.walk},update:function(){ig.game.collisionMap.getTile(this.pos.x+(this.flip?4:this.size.x-4),this.pos.y+this.size.y+1)||(this.flip=!this.flip),ig.game.collisionMap.getTile(this.pos.x+(this.flip?-4:this.size.x+4),this.pos.y+10)&&(this.flip=!this.flip);var t=this.flip?-1:1;this.vel.x=this.speed*t,this.parent()},receiveSunDamage:function(t,e){for(this.receiveDamage(t,e),i=0;1>i;i++)ig.game.spawnEntity(EntityAshParticle,this.pos.x,this.pos.y,{width:this.size.x,height:this.size.y})},check:function(t){t.receiveDamage(10,this),this.kill()}})}),ig.baked=!0,ig.module("game.entities.trigger").requires("impact.entity").defines(function(){EntityTrigger=ig.Entity.extend({size:{x:16,y:16},_wmScalable:!0,_wmDrawBox:!0,_wmBoxColor:"rgba(196, 255, 0, 0.7)",target:null,wait:-1,waitTimer:null,canFire:!0,type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.A,collides:ig.Entity.COLLIDES.NEVER,init:function(t,e,i){i.checks&&(this.checkAgainst=ig.Entity.TYPE[i.checks.toUpperCase()]||ig.Entity.TYPE.A,delete i.check),this.parent(t,e,i),this.waitTimer=new ig.Timer},check:function(t){if(this.canFire&&this.waitTimer.delta()>=0){if("object"==typeof this.target)for(var e in this.target){var i=ig.game.getEntityByName(this.target[e]);i&&"function"==typeof i.triggeredBy&&i.triggeredBy(t,this)}-1==this.wait?this.canFire=!1:this.waitTimer.set(this.wait)}},update:function(){}})}),ig.baked=!0,ig.module("game.entities.staticImage").requires("impact.entity").defines(function(){EntityStaticImage=ig.Entity.extend({size:{x:64,y:64},type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,collides:ig.Entity.TYPE.NEVER,_wmDrawBox:!0,_wmBoxColor:"rgba(255,224,122,0.4)",image:"media/null.png",init:function(t,e,i){this.parent(t,e,i),this.animSheet=new ig.AnimationSheet(this.image,64,64),this.addAnim("idle",1,[0])}})}),ig.baked=!0,ig.module("game.levels.1").requires("impact.image","game.entities.playerL1","game.entities.level1Logic","game.entities.sunPowerup","game.entities.enemySpider","game.entities.trigger","game.entities.staticImage").defines(function(){Level1={entities:[{type:"EntityPlayerL1",x:72,y:376,settings:{name:"PlayerLevel1"}},{type:"EntityLevel1Logic",x:48,y:148},{type:"EntitySunPowerup",x:1084,y:212},{type:"EntityEnemySpider",x:748,y:360},{type:"EntityEnemySpider",x:1276,y:156},{type:"EntityEnemySpider",x:1056,y:484},{type:"EntityEnemySpider",x:1424,y:504},{type:"EntityEnemySpider",x:332,y:512},{type:"EntityTrigger",x:4,y:504,settings:{size:{x:104,y:80},name:"winTrigger",target:{1:"PlayerLevel1"}}},{type:"EntityStaticImage",x:40,y:516,settings:{image:"media/winFlag.png"}}],layer:[{name:"background",width:8,height:20,linkWithCollision:!1,visible:1,tilesetName:"media/tileset_bg.png",repeat:!0,preRender:!0,distance:"2",tilesize:64,foreground:!1,data:[[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,2,3,4,1,2,3,4],[5,6,7,8,5,6,7,8],[9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9]]},{name:"main",width:30,height:10,linkWithCollision:!0,visible:1,tilesetName:"media/Tileset2.png",repeat:!1,preRender:!0,distance:"1",tilesize:64,foreground:!1,data:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,4,2,2,2,2,2,2,2,2,2,2,2,14,15],[2,0,0,0,0,0,0,0,0,0,31,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,11,12,13,14,15,0],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0]]},{name:"collision",width:30,height:20,linkWithCollision:!1,visible:1,tilesetName:"",repeat:!1,preRender:!1,distance:1,tilesize:64,foreground:!1,data:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]}]},Level1Resources=[new ig.Image("media/tileset_bg.png"),new ig.Image("media/Tileset2.png")]}),ig.baked=!0,ig.module("game.entities.mainMenu").requires("impact.entity").defines(function(){EntityMainMenu=ig.Entity.extend({name:"mainMenu",font:new ig.Font("media/impact_bitmap.png"),redFont:new ig.Font("media/impact_bitmap_red.png"),items:[{text:"PLAY",exec:function(){ig.game.loadLevel(Level1)}},{text:"OPTIONS",exec:function(){console.log("clicked options")}}],hitboxList:[],initYOffset:100,initXOffset:150,ySpacing:100,alignment:ig.Font.ALIGN.CENTER,currSelected:null,_wmDrawBox:!0,_wmBoxColor:"rgba(255, 0, 0, 0.4)",animSheet:new ig.AnimationSheet("media/null.png",64,64),collision:ig.Entity.COLLIDES.NONE,type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,size:{x:64,y:64},offset:{x:0,y:0},init:function(t,e,i){if(this.parent(t,e,i),this.addAnim("idle",1,[0]),!ig.global.wm){for(var n=0;n<this.items.length;n++){var s=this.font.widthForString(this.items[n].text),a=this.font.heightForString(this.items[n].text),o={x:ig.system.width/2-s/2+this.initXOffset,y:this.initYOffset+n*this.ySpacing},r={x:ig.system.width/2+s/2+this.initXOffset,y:this.initYOffset+n*this.ySpacing+a};
this.hitboxList.push(new hitbox(o,r,n))}ig.input.initMouse(),ig.input.bind(ig.KEY.MOUSE1,"shoot"),ig.game.clearColor="#ffffff"}},update:function(){this.parent(),this.currentAnim=this.anims.idle,this.currSelected=null;for(var t=0;t<this.hitboxList.length;t++)this.hitboxList[t].isTouching(ig.input.mouse.x,ig.input.mouse.y)&&(this.currSelected=this.hitboxList[t].key);ig.input.state("shoot")&&null!=this.currSelected&&this.items[this.currSelected].exec()},draw:function(){if(this.parent(),!ig.global.wm)for(var t=0;t<this.items.length;t++)t!=this.currSelected?this.font.draw(this.items[t].text,this.initXOffset+ig.system.width/2,this.initYOffset+t*this.ySpacing,this.alignment):this.redFont.draw(this.items[t].text,this.initXOffset+ig.system.width/2,this.initYOffset+t*this.ySpacing,this.alignment)},createHitbox:function(t,e,i){this.hitboxList.push(new hitbox(t,e,i))}})});var hitbox=function(t,e,i){this.pos1={},this.pos2={},this.pos1.x=t.x,this.pos1.y=t.y,this.pos2.x=e.x,this.pos2.y=e.y,this.key=i,this.isTouching=function(t,e){return t>this.pos1.x&&t<this.pos2.x&&e>this.pos1.y&&e<this.pos2.y}};ig.baked=!0,ig.module("game.levels.mainMenu").requires("impact.image","game.entities.mainMenu").defines(function(){LevelMainMenu={entities:[{type:"EntityMainMenu",x:272,y:136}],layer:[{name:"bgLayer",width:13,height:10,linkWithCollision:!1,visible:1,tilesetName:"media/menu.jpg",repeat:!1,preRender:!0,distance:"1",tilesize:64,foreground:!1,data:[[33,34,35,36,37,38,39,39,39,39,39,40,41],[48,49,50,51,52,53,54,54,54,54,54,55,56],[63,64,65,66,67,68,69,69,69,69,69,70,71],[78,79,80,81,82,83,84,84,84,84,84,85,86],[93,94,95,96,97,98,99,99,99,99,99,100,101],[108,109,110,111,112,113,114,114,114,114,114,115,116],[123,124,125,126,127,128,129,129,129,129,129,130,131],[138,139,140,141,142,143,144,144,144,144,144,145,146],[153,154,155,156,157,158,159,159,159,159,159,160,161],[168,169,170,171,172,173,174,174,174,174,174,175,176]]}]},LevelMainMenuResources=[new ig.Image("media/menu.jpg")]}),ig.baked=!0,ig.module("game.entities.winMenu").requires("impact.entity").defines(function(){EntityWinMenu=ig.Entity.extend({name:"winMenu",font:new ig.Font("media/impact_bitmap.png"),redFont:new ig.Font("media/impact_bitmap_red.png"),items:[{text:"MAIN MENU",exec:function(){ig.game.loadLevel(LevelMainMenu)}}],hitboxList:[],initYOffset:500,initXOffset:0,ySpacing:100,alignment:ig.Font.ALIGN.CENTER,currSelected:null,_wmDrawBox:!0,_wmBoxColor:"rgba(255, 0, 0, 0.4)",animSheet:new ig.AnimationSheet("media/null.png",64,64),collision:ig.Entity.COLLIDES.NONE,type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,size:{x:64,y:64},offset:{x:0,y:0},init:function(t,e,i){if(this.parent(t,e,i),this.addAnim("idle",1,[0]),!ig.global.wm){for(var n=0;n<this.items.length;n++){var s=this.font.widthForString(this.items[n].text),a=this.font.heightForString(this.items[n].text),o={x:ig.system.width/2-s/2+this.initXOffset,y:this.initYOffset+n*this.ySpacing},r={x:ig.system.width/2+s/2+this.initXOffset,y:this.initYOffset+n*this.ySpacing+a};this.hitboxList.push(new hitbox(o,r,n))}ig.input.initMouse(),ig.input.bind(ig.KEY.MOUSE1,"shoot")}},update:function(){this.parent(),this.currentAnim=this.anims.idle,this.currSelected=null;for(var t=0;t<this.hitboxList.length;t++)this.hitboxList[t].isTouching(ig.input.mouse.x,ig.input.mouse.y)&&(this.currSelected=this.hitboxList[t].key);ig.input.state("shoot")&&null!=this.currSelected&&this.items[this.currSelected].exec()},draw:function(){if(this.parent(),!ig.global.wm)for(var t=0;t<this.items.length;t++)t!=this.currSelected?this.font.draw(this.items[t].text,this.initXOffset+ig.system.width/2,this.initYOffset+t*this.ySpacing,this.alignment):this.redFont.draw(this.items[t].text,this.initXOffset+ig.system.width/2,this.initYOffset+t*this.ySpacing,this.alignment)},createHitbox:function(t,e,i){this.hitboxList.push(new hitbox(t,e,i))}})});var hitbox=function(t,e,i){this.pos1={},this.pos2={},this.pos1.x=t.x,this.pos1.y=t.y,this.pos2.x=e.x,this.pos2.y=e.y,this.key=i,this.isTouching=function(t,e){return t>this.pos1.x&&t<this.pos2.x&&e>this.pos1.y&&e<this.pos2.y}};ig.baked=!0,ig.module("game.entities.levelWinLogic").requires("impact.entity").defines(function(){EntityLevelWinLogic=ig.Entity.extend({font:new ig.Font("media/impact_bitmap_large_yellow.png"),initYOffset:25,initXOffset:0,alignment:ig.Font.ALIGN.CENTER,_wmDrawBox:!0,_wmBoxColor:"rgba(0, 125, 125, 0.4)",animSheet:new ig.AnimationSheet("media/null.png",64,64),collision:ig.Entity.COLLIDES.NONE,type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,size:{x:64,y:64},offset:{x:0,y:0},init:function(t,e,i){this.parent(t,e,i),this.addAnim("idle",1,[0]),ig.global.wm||(ig.game.clearColor="#969696")},update:function(){this.parent(),this.currentAnim=this.anims.idle},draw:function(){this.parent(),ig.global.wm||this.font.draw("Congratulations!\nYou won!\nPlay again?",this.initXOffset+ig.system.width/2,this.initYOffset,this.alignment)}})}),ig.baked=!0,ig.module("game.levels.win").requires("impact.image","game.entities.winMenu","game.entities.levelWinLogic").defines(function(){LevelWin={entities:[{type:"EntityWinMenu",x:64,y:24},{type:"EntityLevelWinLogic",x:336,y:108}],layer:[]}}),ig.baked=!0,ig.module("impact.debug.menu").requires("dom.ready","impact.system").defines(function(){"use strict";ig.System.inject({run:function(){ig.debug.beforeRun(),this.parent(),ig.debug.afterRun()},setGameNow:function(t){this.parent(t),ig.debug.ready()}}),ig.Debug=ig.Class.extend({options:{},panels:{},numbers:{},container:null,panelMenu:null,activePanel:null,debugTime:0,debugTickAvg:.016,debugRealTime:Date.now(),init:function(){var t=ig.$new("link");t.rel="stylesheet",t.type="text/css",t.href=ig.prefix+"lib/impact/debug/debug.css",ig.$("body")[0].appendChild(t),this.container=ig.$new("div"),this.container.className="ig_debug",ig.$("body")[0].appendChild(this.container),this.panelMenu=ig.$new("div"),this.panelMenu.innerHTML='<div class="ig_debug_head">Impact.Debug:</div>',this.panelMenu.className="ig_debug_panel_menu",this.container.appendChild(this.panelMenu),this.numberContainer=ig.$new("div"),this.numberContainer.className="ig_debug_stats",this.panelMenu.appendChild(this.numberContainer),window.console&&window.console.log&&window.console.assert&&(ig.log=console.log.bind?console.log.bind(console):console.log,ig.assert=console.assert.bind?console.assert.bind(console):console.assert),ig.show=this.showNumber.bind(this)},addNumber:function(t){var e=ig.$new("span");this.numberContainer.appendChild(e),this.numberContainer.appendChild(document.createTextNode(t)),this.numbers[t]=e},showNumber:function(t,e,i){this.numbers[t]||this.addNumber(t,i),this.numbers[t].textContent=e},addPanel:function(t){var e=new t.type(t.name,t.label);if(t.options)for(var i=0;i<t.options.length;i++){var n=t.options[i];e.addOption(new ig.DebugOption(n.name,n.object,n.property))}this.panels[e.name]=e,e.container.style.display="none",this.container.appendChild(e.container);var s=ig.$new("div");s.className="ig_debug_menu_item",s.textContent=e.label,s.addEventListener("click",function(){this.togglePanel(e)}.bind(this),!1),e.menuItem=s;for(var a=!1,i=1;i<this.panelMenu.childNodes.length;i++){var o=this.panelMenu.childNodes[i];if(o.textContent>e.label){this.panelMenu.insertBefore(s,o),a=!0;break}}a||this.panelMenu.appendChild(s)},showPanel:function(t){this.togglePanel(this.panels[t])},togglePanel:function(t){t!=this.activePanel&&this.activePanel&&(this.activePanel.toggle(!1),this.activePanel.menuItem.className="ig_debug_menu_item",this.activePanel=null);var e=t.container.style.display,i="block"!=e;t.toggle(i),t.menuItem.className="ig_debug_menu_item"+(i?" active":""),i&&(this.activePanel=t)},ready:function(){for(var t in this.panels)this.panels[t].ready()},beforeRun:function(){var t=Date.now();this.debugTickAvg=.8*this.debugTickAvg+.2*(t-this.debugRealTime),this.debugRealTime=t,this.activePanel&&this.activePanel.beforeRun()},afterRun:function(){var t=Date.now()-this.debugRealTime;1e3/ig.system.fps-t,this.debugTime=.8*this.debugTime+.2*t,this.activePanel&&this.activePanel.afterRun(),this.showNumber("ms",this.debugTime.toFixed(2)),this.showNumber("fps",Math.round(1e3/this.debugTickAvg)),this.showNumber("draws",ig.Image.drawCount),ig.game&&ig.game.entities&&this.showNumber("entities",ig.game.entities.length),ig.Image.drawCount=0}}),ig.DebugPanel=ig.Class.extend({active:!1,container:null,options:[],panels:[],label:"",name:"",init:function(t,e){this.name=t,this.label=e,this.container=ig.$new("div"),this.container.className="ig_debug_panel "+this.name},toggle:function(t){this.active=t,this.container.style.display=t?"block":"none"},addPanel:function(t){this.panels.push(t),this.container.appendChild(t.container)},addOption:function(t){this.options.push(t),this.container.appendChild(t.container)},ready:function(){},beforeRun:function(){},afterRun:function(){}}),ig.DebugOption=ig.Class.extend({name:"",labelName:"",className:"ig_debug_option",label:null,mark:null,container:null,active:!1,colors:{enabled:"#fff",disabled:"#444"},init:function(t,e,i){this.name=t,this.object=e,this.property=i,this.active=this.object[this.property],this.container=ig.$new("div"),this.container.className="ig_debug_option",this.label=ig.$new("span"),this.label.className="ig_debug_label",this.label.textContent=this.name,this.mark=ig.$new("span"),this.mark.className="ig_debug_label_mark",this.container.appendChild(this.mark),this.container.appendChild(this.label),this.container.addEventListener("click",this.click.bind(this),!1),this.setLabel()},setLabel:function(){this.mark.style.backgroundColor=this.active?this.colors.enabled:this.colors.disabled},click:function(t){return this.active=!this.active,this.object[this.property]=this.active,this.setLabel(),t.stopPropagation(),t.preventDefault(),!1}}),ig.debug=new ig.Debug}),ig.baked=!0,ig.module("impact.debug.entities-panel").requires("impact.debug.menu","impact.entity").defines(function(){"use strict";ig.Entity.inject({colors:{names:"#fff",velocities:"#0f0",boxes:"#f00"},draw:function(){if(this.parent(),ig.Entity._debugShowBoxes&&(ig.system.context.strokeStyle=this.colors.boxes,ig.system.context.lineWidth=1,ig.system.context.strokeRect(ig.system.getDrawPos(this.pos.x.round()-ig.game.screen.x)-.5,ig.system.getDrawPos(this.pos.y.round()-ig.game.screen.y)-.5,this.size.x*ig.system.scale,this.size.y*ig.system.scale)),ig.Entity._debugShowVelocities){var t=this.pos.x+this.size.x/2,e=this.pos.y+this.size.y/2;this._debugDrawLine(this.colors.velocities,t,e,t+this.vel.x,e+this.vel.y)}if(ig.Entity._debugShowNames&&(this.name&&(ig.system.context.fillStyle=this.colors.names,ig.system.context.fillText(this.name,ig.system.getDrawPos(this.pos.x-ig.game.screen.x),ig.system.getDrawPos(this.pos.y-ig.game.screen.y))),"object"==typeof this.target))for(var i in this.target){var n=ig.game.getEntityByName(this.target[i]);n&&this._debugDrawLine(this.colors.names,this.pos.x+this.size.x/2,this.pos.y+this.size.y/2,n.pos.x+n.size.x/2,n.pos.y+n.size.y/2)}},_debugDrawLine:function(t,e,i,n,s){ig.system.context.strokeStyle=t,ig.system.context.lineWidth=1,ig.system.context.beginPath(),ig.system.context.moveTo(ig.system.getDrawPos(e-ig.game.screen.x),ig.system.getDrawPos(i-ig.game.screen.y)),ig.system.context.lineTo(ig.system.getDrawPos(n-ig.game.screen.x),ig.system.getDrawPos(s-ig.game.screen.y)),ig.system.context.stroke(),ig.system.context.closePath()}}),ig.Entity._debugEnableChecks=!0,ig.Entity._debugShowBoxes=!1,ig.Entity._debugShowVelocities=!1,ig.Entity._debugShowNames=!1,ig.Entity.oldCheckPair=ig.Entity.checkPair,ig.Entity.checkPair=function(t,e){ig.Entity._debugEnableChecks&&ig.Entity.oldCheckPair(t,e)},ig.debug.addPanel({type:ig.DebugPanel,name:"entities",label:"Entities",options:[{name:"Checks & Collisions",object:ig.Entity,property:"_debugEnableChecks"},{name:"Show Collision Boxes",object:ig.Entity,property:"_debugShowBoxes"},{name:"Show Velocities",object:ig.Entity,property:"_debugShowVelocities"},{name:"Show Names & Targets",object:ig.Entity,property:"_debugShowNames"}]})}),ig.baked=!0,ig.module("impact.debug.maps-panel").requires("impact.debug.menu","impact.game","impact.background-map").defines(function(){"use strict";ig.Game.inject({loadLevel:function(t){this.parent(t),ig.debug.panels.maps.load(this)}}),ig.DebugMapsPanel=ig.DebugPanel.extend({maps:[],mapScreens:[],init:function(t,e){this.parent(t,e),this.load()},load:function(t){if(this.options=[],this.panels=[],!t||!t.backgroundMaps.length)return this.container.innerHTML="<em>No Maps Loaded</em>",void 0;this.maps=t.backgroundMaps,this.mapScreens=[],this.container.innerHTML="";for(var e=0;e<this.maps.length;e++){var i=this.maps[e],n=new ig.DebugPanel(e,"Layer "+e),s=new ig.$new("strong");s.textContent=e+": "+i.tiles.path,n.container.appendChild(s),n.addOption(new ig.DebugOption("Enabled",i,"enabled")),n.addOption(new ig.DebugOption("Pre Rendered",i,"preRender")),n.addOption(new ig.DebugOption("Show Chunks",i,"debugChunks")),this.generateMiniMap(n,i,e),this.addPanel(n)}},generateMiniMap:function(t,e,i){var n=ig.system.scale,s=ig.$new("canvas"),a=s.getContext("2d"),o=e.tiles.width*n,r=e.tiles.height*n,l=o/e.tilesize,h=r/e.tilesize;a.drawImage(e.tiles.data,0,0,o,r,0,0,l,h);var c=ig.$new("canvas");c.width=e.width*n,c.height=e.height*n;var d=c.getContext("2d");ig.game.clearColor&&(d.fillStyle=ig.game.clearColor,d.fillRect(0,0,o,r));for(var u=0,g=0;g<e.width;g++)for(var p=0;p<e.height;p++)(u=e.data[p][g])&&d.drawImage(s,Math.floor((u-1)*n%l),Math.floor((u-1)*n/l)*n,n,n,g*n,p*n,n,n);var m=ig.$new("div");m.className="ig_debug_map_container",m.style.width=e.width*n+"px",m.style.height=e.height*n+"px";var f=ig.$new("div");f.className="ig_debug_map_screen",f.style.width=ig.system.width/e.tilesize*n-2+"px",f.style.height=ig.system.height/e.tilesize*n-2+"px",this.mapScreens[i]=f,m.appendChild(c),m.appendChild(f),t.container.appendChild(m)},afterRun:function(){for(var t=ig.system.scale,e=0;e<this.maps.length;e++){var i=this.maps[e],n=this.mapScreens[e];if(i&&n){var s=i.scroll.x/i.tilesize,a=i.scroll.y/i.tilesize;i.repeat&&(s%=i.width,a%=i.height),n.style.left=s*t+"px",n.style.top=a*t+"px"}}}}),ig.debug.addPanel({type:ig.DebugMapsPanel,name:"maps",label:"Background Maps"})}),ig.baked=!0,ig.module("impact.debug.graph-panel").requires("impact.debug.menu","impact.system","impact.game","impact.image").defines(function(){"use strict";ig.Game.inject({draw:function(){ig.graph.beginClock("draw"),this.parent(),ig.graph.endClock("draw")},update:function(){ig.graph.beginClock("update"),this.parent(),ig.graph.endClock("update")},checkEntities:function(){ig.graph.beginClock("checks"),this.parent(),ig.graph.endClock("checks")}}),ig.DebugGraphPanel=ig.DebugPanel.extend({clocks:{},marks:[],textY:0,height:128,ms:64,timeBeforeRun:0,init:function(t,e){this.parent(t,e),this.mark16ms=(this.height-16*(this.height/this.ms)).round(),this.mark33ms=(this.height-33*(this.height/this.ms)).round(),this.msHeight=this.height/this.ms,this.graph=ig.$new("canvas"),this.graph.width=window.innerWidth,this.graph.height=this.height,this.container.appendChild(this.graph),this.ctx=this.graph.getContext("2d"),this.ctx.fillStyle="#444",this.ctx.fillRect(0,this.mark16ms,this.graph.width,1),this.ctx.fillRect(0,this.mark33ms,this.graph.width,1),this.addGraphMark("16ms",this.mark16ms),this.addGraphMark("33ms",this.mark33ms),this.addClock("draw","Draw","#13baff"),this.addClock("update","Entity Update","#bb0fff"),this.addClock("checks","Entity Checks & Collisions","#a2e908"),this.addClock("lag","System Lag","#f26900"),ig.mark=this.mark.bind(this),ig.graph=this},addGraphMark:function(t,e){var i=ig.$new("span");i.className="ig_debug_graph_mark",i.textContent=t,i.style.top=e.round()+"px",this.container.appendChild(i)},addClock:function(t,e,i){var n=ig.$new("span");n.className="ig_debug_legend_color",n.style.backgroundColor=i;var s=ig.$new("span");s.className="ig_debug_legend_number",s.appendChild(document.createTextNode("0"));var a=ig.$new("span");a.className="ig_debug_legend",a.appendChild(n),a.appendChild(document.createTextNode(e+" (")),a.appendChild(s),a.appendChild(document.createTextNode("ms)")),this.container.appendChild(a),this.clocks[t]={description:e,color:i,current:0,start:Date.now(),avg:0,html:s}},beginClock:function(t,e){this.clocks[t].start=Date.now()+(e||0)},endClock:function(t){var e=this.clocks[t];e.current=Math.round(Date.now()-e.start),e.avg=.8*e.avg+.2*e.current},mark:function(t,e){this.active&&this.marks.push({msg:t,color:e||"#fff"})},beforeRun:function(){this.endClock("lag"),this.timeBeforeRun=Date.now()},afterRun:function(){var t=Date.now()-this.timeBeforeRun,e=1e3/ig.system.fps-t;this.beginClock("lag",Math.max(e,0));var i=this.graph.width-1,n=this.height;this.ctx.drawImage(this.graph,-1,0),this.ctx.fillStyle="#000",this.ctx.fillRect(i,0,1,this.height),this.ctx.fillStyle="#444",this.ctx.fillRect(i,this.mark16ms,1,1),this.ctx.fillStyle="#444",this.ctx.fillRect(i,this.mark33ms,1,1);for(var s in this.clocks){var a=this.clocks[s];if(a.html.textContent=a.avg.toFixed(2),a.color&&a.current>0){this.ctx.fillStyle=a.color;var o=a.current*this.msHeight;n-=o,this.ctx.fillRect(i,n,1,o),a.current=0}}this.ctx.textAlign="right",this.ctx.textBaseline="top",this.ctx.globalAlpha=.5;for(var r=0;r<this.marks.length;r++){var l=this.marks[r];this.ctx.fillStyle=l.color,this.ctx.fillRect(i,0,1,this.height),l.msg&&(this.ctx.fillText(l.msg,i-1,this.textY),this.textY=(this.textY+8)%32)}this.ctx.globalAlpha=1,this.marks=[]}}),ig.debug.addPanel({type:ig.DebugGraphPanel,name:"graph",label:"Performance"})}),ig.baked=!0,ig.module("impact.debug.debug").requires("impact.debug.entities-panel","impact.debug.maps-panel","impact.debug.graph-panel").defines(function(){"use strict"}),ig.baked=!0,ig.module("plugins.gui").requires("impact.game").defines(function(){ig.gui={show:!0,initialized:!1,cursor:{pos:{x:0,y:0},offset:{x:0,y:0},image:null,set:function(t){this.image=t},clear:function(){this.image=null},draw:function(){null!=this.image&&this.image.draw(this.pos.x-this.offset.x,this.pos.y-this.offset.y)}},elements:[],element:{action:function(t,e){for(var i=[],n=0;n<ig.gui.elements.length;n++)"getByName"==t&&ig.gui.elements[n].name==e&&i.push(ig.gui.elements[n]),"getByGroup"==t&&ig.gui.elements[n].group==e&&i.push(ig.gui.elements[n]),"show"==t&&ig.gui.elements[n].name==e&&(ig.gui.elements[n].show=!0),"showGroup"==t&&ig.gui.elements[n].group==e&&(ig.gui.elements[n].show=!0),"hide"==t&&ig.gui.elements[n].name==e&&(ig.gui.elements[n].show=!1),"hideGroup"==t&&ig.gui.elements[n].group==e&&(ig.gui.elements[n].show=!1),"remove"==t&&ig.gui.elements[n].name==e&&ig.gui.elements.erase(ig.gui.elements[n]),"removeGroup"==t&&ig.gui.elements[n].group==e&&ig.gui.elements.erase(ig.gui.elements[n]),"enable"==t&&ig.gui.elements[n].name==e&&(ig.gui.elements[n].disable=!1),"enableGroup"==t&&ig.gui.elements[n].group==e&&(ig.gui.elements[n].disable=!1),"enable"==t&&ig.gui.elements[n].name==e&&(ig.gui.elements[n].disable=!0),"enableGroup"==t&&ig.gui.elements[n].group==e&&(ig.gui.elements[n].disable=!0),"disableAll"==t&&(ig.gui.elements[n].disable=!0);return i.length?(1==i.length&&(i=i[0]),i):void 0},add:function(t){void 0==t.show&&(t.show=!0),void 0==t.disabled&&(t.disabled=!1),void 0==t.active&&(t.active=!1),ig.gui.elements.push(t)},draw:function(){for(var t=0;t<ig.gui.elements.length;t++){var e=ig.gui.elements[t],i="normal";if(e.show){ig.gui.cursor.pos.x>=e.pos.x&&ig.gui.cursor.pos.x<=e.pos.x+e.size.x&&ig.gui.cursor.pos.y>=e.pos.y&&ig.gui.cursor.pos.y<=e.pos.y+e.size.y&&!e.disabled&&(i="hover"),"hover"==i&&(ig.input.state("mouse1")||ig.input.pressed("mouse1"))&&(i="active",ig.input.state("mouse1")&&"function"==typeof ig.gui.elements[t].mouseDown&&ig.gui.elements[t].mouseDown.call(e),ig.input.pressed("mouse1")&&(e.toggle&&(e.active=!e.active),"function"==typeof ig.gui.elements[t].click&&ig.gui.elements[t].click.call(e))),e.toggle&&e.active&&(i="active"),void 0==ig.gui.elements[t].state[i]&&(i="normal"),void 0!=e.alpha&&(ig.system.context.globalAlpha=e.alpha);var n=ig.gui.elements[t].state[i];isNaN(n.tile)||isNaN(n.tileSize)?n.image.draw(e.pos.x,e.pos.y):n.image.drawTile(e.pos.x,e.pos.y,n.tile,n.tileSize),ig.system.context.globalAlpha=1}}}},draw:function(){this.element.draw(),this.cursor.pos={x:ig.input.mouse.x,y:ig.input.mouse.y},this.cursor.draw()}},ig.Game.inject({init:function(){this.parent(),ig.gui.initialized||(ig.gui.initialized=!0,ig.input.bind(ig.KEY.MOUSE1,"mouse1"))},update:function(){this.parent()}})}),ig.baked=!0,ig.module("plugins.pause").requires("impact.game","impact.timer").defines(function(){ig.Game.inject({paused:!1,pauseDelayTimer:new ig.Timer,pauseButtonDelay:.2,updateEntities:function(){for(var t=0;ent=this.entities[t];t++)ent._killed||this.paused?ent.ignorePause&&ent.update():ent.update()},togglePause:function(t){this.pauseDelayTimer.delta()>this.pauseButtonDelay&&(this.paused=null!=t?t:!this.paused,this.paused?this.onPause():this.onResume(),this.pauseDelayTimer.reset())},onResume:function(){},onPause:function(){}}),ig.Entity.inject({ignorePause:!1})}),ig.baked=!0,ig.module("game.main").requires("impact.game","impact.font","game.entities.bloodParticle","game.entities.ashParticle","game.levels.1","game.levels.mainMenu","game.levels.win","impact.debug.debug","plugins.gui","plugins.pause").defines(function(){MyGame=ig.Game.extend({gravity:500,clearColor:"#ffffff",font:new ig.Font("media/04b03.font.png"),scale:1,init:function(){ig.soundManager.volume=.1,this.loadLevel(LevelMainMenu)},update:function(){this.parent();var t=this.getEntitiesByType(EntityPlayer)[0];t&&(this.screen.x=t.pos.x-ig.system.width/2,this.screen.y=t.pos.y-ig.system.height/2)},draw:function(){this.parent();var t=this.getEntitiesByType(EntityPlayer)[0];t&&(this.screen.x=t.pos.x-ig.system.width/2,this.screen.y=t.pos.y-ig.system.height/2)}}),ig.main("#canvas",MyGame,60,800,600,1)});